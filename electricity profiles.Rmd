--- 
title: "Electricity Profiles Cloudbook: R technique"
author: "Puttipong Chunark, Ph.D."
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [report.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This is electricity profile cloudbook. This book provides the characteristic 
  of electricity profiles at all levels in Thailand. It gives the peak and
  and minimum load in (MW) and time. Load factor is calculated.
link-citations: yes
github-repo: PChunark/load_forecast_EGAT_strategies
---

# About {-}

This webpage is created to understand the electricity load profile at all 
levels. R coding techniques are included. Readers can learn how to code 
the R language in the format of scripts, R markdown, and bookdown.

<!--chapter:end:index.Rmd-->

# Introduction

```{r, library load, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
```

Electricity is one of the key final energy to drive an economy. It is used to provide enduse demands. For instance, charging electric vehicles (EVs), lighting houses, heating water and cooking, driving motors to convey products in industrial processes.

## Electricity consumption situation

The Department of Alternative Energy Development and Efficiency (DEDE) published the **"Energy Balance of Thailand 2021"**. The report provides Thailand's energy statistics in all sectors. In 2021, an electricity consumption (Final energy consumption) was 201,016 GWh [@dede2021]. Manufacturing industry consumed the highest electricity (see Table \@ref(tab:fnely2021)). It accounted for 39% of total electricity consumption in 2021. Commercial and residential sectors were the second and the third largest electricity consumption. They accounted for 33% and 27%. The rest were mining (0.6%), agriculture (0.2%) and transport sectors (0.1%). Further energy statistics can be found in the report on page 57, "Thailand energy commodity account 2021".


```{r, fnely2021, echo=FALSE, warning=FALSE, message=FALSE}
knitr::kable(
  tibble(Sector = c("Agriculture", "Mining", "Manufac. industry", "Construction", 
                  "Residential", "Commercial", "Transport (Road)", "Transport (Rail)"),
       "Electricity (GWh)" = c(398, 1279, 78919, "na", 54481, 65718, 1, 220)), 
  caption = "Electricity consumption in 2021",
  booktabs = TRUE
)
```

## Electricity generation situation

The electricity generation was 186,699 GWh in 2021. The exported and imported electricity were 33,356 GWh and 1,996 GWh. The electricity losses and own uses were 14,098 GWh and 2,945 GWh. Natural gas combined cycle power plants accounted for 59% of total electricity generation in 2021. Thermal power plants accounted for 30%. Table \@ref(tab:elygen2021) gives the electricity generation by power plant in 2021.

```{r, elygen2021, echo=FALSE, warning=FALSE, message=FALSE}
knitr::kable(
  tibble("Power plant type" = c("Hydro", "Thermal", "Gas turbine", "Combined cycle", 
                  "Diesel", "Gas engine", "Others", "Total"),
       "Electricity (GWh)" = c(4682, 56737, 1318, 110597, 28, 4769, 8568, 186699)), 
  caption = "Electricity generation in 2021",
  booktabs = TRUE
)
```


Coal & its products consumption rapidly decreased in generating an electricity from 2017-2021.
Solar and wind played a vital role in producing an electricity (see Figure \@ref(fig:fig-fuelelygen2017-2021)). The unit of COAL & ITS PRODUCTS, paddy husk, bagasses, agricultural waste and MSW are **thousand ton**. The unit of PETROLEUM PRODUCTS's and NATURAL GAS are **million litres (M.Litres)** and **MMscf.**, respectively. The electricity generation from solar, wind, small hydro power, large hydro power and geothermal, is reported in **GWh**. Biogas and OTHER energies are presented in **cubic meter (m^3^)** and **GJ**, respectively. 

```{r, tab_fuelelygen2017_2021, echo=FALSE, warning=FALSE, message=FALSE}

fuelelygen2017_2021<-
  tibble("Fuel type" = c("COAL & ITS PRODUCTS", "Anthracite", "Bituminous", "Lignite", "Briquettes & other coal",
                       "PETROLEUM PRODUCTS", "HSD", "Fuel oil",
                       "NATURAL GAS",
                       "RENEWABLE ENERGY", "Solar", "Wind", "Small hydro power", "Large hydro power", "Geothermal",
                       "Paddy husk", "Bagasse", "Agricultural waste", "MSW", 
                       "Biogas",
                       "OTHERS"),
       unit = c("thousand ton","thousand ton","thousand ton","thousand ton","thousand ton",
                "M.Litres","M.Litres","M.Litres",
                "MMscf.",
                NA, "GWh","GWh","GWh","GWh","GWh", 
                "thousand ton","thousand ton","thousand ton","thousand ton", 
                "m3",
                "GJ"),
       "2017" = c(21801, 0, 4964, 15898, 945,
                  72, 44, 28,
                  1108683,
                  NA, 4543, 1109, 504, 4329, 1, 
                  2455, 21602, 6520, 317, 
                  1060449427,
                  19982002),
       "2018" = c(20518, 0, 5333, 14169, 1016,
                  56, 40, 16,
                  1073831,
                  NA, 4537, 1641, 615, 7168, 1, 
                  2028, 24476, 7774, 580, 
                  1190465701,
                  21121440),
       "2019" = c(20052, 0, 5110, 13761, 1181,
                  66, 40, 26,
                  1059300,
                  NA, 5146, 3670, 441, 6005, 1, 
                  2105, 26835, 8617, 890, 
                  1319121140,
                  19842988),
       "2020" = c(19749, 0, 5286, 13223, 1240,
                  59, 30, 29,
                  1091779,
                  NA, 5031, 3220, 348, 4333, 1, 
                  2048, 23352, 8902, 1249, 
                  1054201606,
                  17228533),
       "2021" = c(20045,0,4698,14245,1102,
                  165,67,98,
                  1022759,
                  NA, 5015, 3552, 474, 4208, 1, 
                  2772, 24026, 9677, 1490, 
                  1161467101,
                  19251302)
        )
```

```{r, plot_fuelelygen2017_2021, echo=FALSE}

plot_fuelelygen2017_2021 <- 
fuelelygen2017_2021 %>% 
  pivot_longer(-c(`Fuel type`, unit ), names_to = "year") %>%
  filter(`Fuel type` != "RENEWABLE ENERGY") %>% 
  ggplot()+
  geom_line(aes(x = year, y = value, group = `Fuel type`, color = `Fuel type`),
            show.legend = FALSE)+
  facet_wrap(~`Fuel type`, scales = "free_y")+
  labs(x = NULL,
       y = "Fuel consumption (Physical units)")+
  theme_bw()+
  theme(strip.background=element_rect(fill="white", colour="white"),
    strip.text.x = element_text(size=7, colour = "black", angle = 0,face="bold"),
    axis.text.x=element_text(size = 10,angle=45, vjust=1.5, hjust=1, margin = unit(c(t = 0.3, r = 0, b = 0, l = 0), "cm")))
```

```{r, fig-fuelelygen2017-2021, echo=FALSE, fig.cap='Fuel consumption for electricity generation from 2017–2021.', fig.align='center', out.width= '90%'}
plot_fuelelygen2017_2021
```




## Initial settings
### Packages setting
Before the project starts, packages are required as follows:

* A `tidyverse` package is a bunch of packages to handle with a data analysis (for more information click [here](https://www.tidyverse.org/packages/)). It consists of data manipulation and visualization as follows:
  * A `ggplot2` [package](https://ggplot2.tidyverse.org/) is for data visualization.
  * A `dplyr` [package](https://dplyr.tidyverse.org/) is for data manipulation.
  * A `tidyr` [package](https://tidyr.tidyverse.org/) is for data tidying.
  * A `readr` [package](https://readr.tidyverse.org/) is for data import.
  * A `purrr` [package](https://purrr.tidyverse.org/) is for functional programming.
  * A `tibble` [package](https://tibble.tidyverse.org/) is a modern reimagining of the data.frame.
  * A `stringr` [package](https://github.com/tidyverse/stringr) is for strings.
  * A `forcats` [package](https://github.com/tidyverse/forcats) is for factors.
  * A `lubridate` [package](https://github.com/tidyverse/lubridate) is for date and time.
* A `readxl` [package](https://readxl.tidyverse.org/) is used for read data from **Excel** into R.
* A `scales` [package](https://scales.r-lib.org/) is applied to scale plots in the ggplot2 package.
* A `glue` [package](https://glue.tidyverse.org/) interprets strings literal. The package embeds R expressions and inserts into argument string.
* A `knitr` [package](https://github.com/yihui/knitr) is a lightweight API's designed to give users full control of the output without heavy coding work. In this project, the package is used for making a HTML. 

```{r, library setting, results='hide', message=FALSE}
library(tidyverse) #For data manipulation
library(readxl) #For reading the excel sheet
library(scales)
library(glue)
library(knitr)
library(plotly)
```
### Theme setting
Theme and lines for figures are set in a variable named `Themeline` as follows:

* `theme_bw()` [function](https://ggplot2.tidyverse.org/reference/ggtheme.html) provides a black and white theme.
* `theme()` function applied for setting theme and line represented in plots.
* `linepalette1` and `linepalette1` variables set line colors.

```{r, theme setting, results='hide', message=FALSE, warning=FALSE}
ThemeLine <- 
  theme_bw() +
  theme(
    panel.border=element_rect(fill=NA),
    panel.grid.minor = element_line(color = NA), 
    #    axis.title=element_text(size=5),
    #    axis.text.x = element_text(hjust=1,size = 10, angle = 0),
    axis.line=element_line(colour="black"),
    panel.background=element_rect(fill = "white"),
    panel.grid.major.x=element_line(linetype="dashed",colour="grey",linewidth = 0.5),
    panel.grid.major.y = element_blank(),
    # panel.grid.major=element_blank(),
    strip.background=element_rect(fill="white", colour="white"),
    strip.text.x = element_text(size=10, colour = "black", angle = 0,face="bold"),
    axis.text.x=element_text(size = 10,angle=45, vjust=0.9, hjust=1, margin = unit(c(t = 0.3, r = 0, b = 0, l = 0), "cm")),
    axis.text.y=element_text(size = 10,margin = unit(c(t = 0, r = 0.3, b = 0, l = 0), "cm")),
    legend.text = element_text(size = 10),
    legend.title = element_text(size = 10),
    axis.ticks.length=unit(-0.15,"cm")
  )
linepalette1 <- c("#4DAF4A","#FF7F00","#377EB8","#E41A1C","#984EA3","#F781BF","#8DD3C7","#FB8072","#80B1D3","#FDB462","#B3DE69","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F","#7f878f","#A65628","#FFFF33")
linepalette2 <- c("#E41A1C","#FF7F00","#377EB8","#B3DE69","#4DAF4A","#984EA3","#F781BF","#8DD3C7","#FB8072","#80B1D3","#FDB462","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F","#7f878f","#A65628","#FFFF33")

```
### Directory setting
Lists are create to store variables.

```{r, make list}
#----- Make a list of profile to store data -----####

profiledata <- list()
profilefigure <- list()
summarydata <- list()
```

```{r, variable for output}
#----- Make variable for output directory -----####
outfigdir <- c("figures/")
```

<!--chapter:end:01.1-intro.Rmd-->

# Electricity profiles 
This chapter provides electricity profiles and a R coding technique. 
Electricity profiles are illustrated to give an insight into profile behavior. 
R coding technique are given in order to understand the process flow and 
manage the big data obtained from several sources in the organization.

## The EGAT electrity sale profiles

### The 2019 Metropolitan Electricity Authority (MEA) EGAT sale profile
The electricity sale profile from EGAT is given by the Power System Control and Operation Division (ฝ่ายควบคุมระบบกำลังไฟฟ้า).


```{r, MEA EGAT sale}
#----- The 2019 MEA EGAT sale profile ----####
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
           sheet = "Load Curve",
           range = "C3:D17523"
            ) %>% 
  select(datetime = `Date/Time`, MEA) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, MEA)
```

```{r profile-egat-to-mea-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to MEA profile',
  booktabs = TRUE
)
```

The peak, minimun in the unit of MW, and an electricity sale to MEA in GWh from the profile are calculated.
The electricity sale to MEA (in GWh) is calculated by the summation of profile in MW divided by 2000.

The reason to divide by **2,000** is that the profile is given a time stamp in **every 30-min**. There are **17,520** values. Therefore, the profile is divided by **2** to get the results in **every 1 hr.**. We divided the output by **1,000** to convert the unit **from MWh to GWh** (see equation \@ref(eq:energycal)).

\begin{equation}
 Ene_{t}=\frac{\sum_{h=1}^{17520} (Prf_{t,h})}{2*1000}
 (\#eq:energycal)
\end{equation} 

Where, $Ene_{t}$ denotes an calculated energy (electricity) in year $t$.\
$Prf_{t,h}$ denotes a profile ($Prf$) in the unit of MW in year $t$ at a time stamp $h$.\
$h$ denotes a time stamp in a 30-minute interval. Therefore, there are **17,520 intervals** in a year (8,760 hrs.).

```{r, find peak and min MW}
# Summary data ####
maxv <- ceiling(max(profile$MEA)) # Get a peak MW
minv <- floor(min(profile$MEA)) # Get a min MW
energy <- sum(profile$MEA)/2000 # Calculate the energy
```

The peak and minimum MW days are also needed to assess in order to provide the maximum and minimum a saled electricity from EGAT to MEA.
```{r, peak & min day}
peak_day <- profile %>% #Find a peak day
            group_by(year) %>% 
            filter(MEA == max(MEA)) %>% 
            pull(datetime)
min_day <- profile %>% #Find a peak day
           group_by(year) %>% 
           filter(MEA == min(MEA)) %>% 
           pull(datetime)
```

Load factor is calculated by the energy in equation \@ref(eq:energycal) divided a maximum energy. A maximum energy is **the peak multiplied by 8760 hours**. Result is presented in a percentage.

\begin{equation}
 LF_{t}=\frac{Energy_{t}}{Peak_{d,h} * 8760}*100 
 (\#eq:loadfactorcal)
\end{equation} 

Where, $LF_{t}$ denotes the load factor at year $t$ in percentage.\
$Energy_{t}$ denotes the calculated energy from equation \@ref(eq:energycal) at year $t$ in GWh.\
$Peak_{d,h}$ denotes the peak electricity sale on the date $d$ at time $h$.


```{r, load factor}
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
```

Create a table to store relevant data.
```{r, summary data}
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```
In 2019, the electricity sale to MEA by EGAT reached it peak **`r format(maxv, scientific=FALSE, big.mark = ",")`** MW on **`r peak_day`**. The energy (electricity) sale to MEA was **`r format(energy, scientific=FALSE, big.mark = ",")`** GWh.
The summary of the electricity sale to MEA by EGAT in 2019 is given in Table \@ref(tab:sum-egat-to-mea-2019).

```{r sum-egat-to-mea-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to MEA in 2019',
  booktabs = TRUE
)
```


The 2019 electricity sale profile from EGAT to MEA is illustrated (see Figure \@ref(fig:EGAT-sale-to-MEA-2019)).
```{r, EGAT sale to MEA in 2019}
profile_plot <-
    ggplot() + 
    geom_line(data=profile, 
              aes(x = datetime, 
                  y = MEA,
                  group = month,
                  color = as.factor(month)),
              show.legend = FALSE) +
    ThemeLine +
    labs(x = NULL,
         y = "EGAT sale to MEA (MW)")+
    scale_x_datetime(breaks=date_breaks("1 month"), 
                     labels=date_format("%b %y")) +
    scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                       limits = c(0, round(maxv, -3))) +  
    scale_color_manual(values = linepalette1) +
    geom_point(data=summary,
               aes(x = peak_day, y = peak_mw))+
    geom_text(data = summary,
              aes(x = peak_day, y = round(maxv, -3)),
              label = glue("Peak {maxv} MW \n@ {peak_day}"))+
    geom_point(data=summary,
               aes(x = min_day, y = min_mw))+
    geom_text(data = summary,
              aes(x = min_day, y = round(minv, -3)),
              label = glue("Minimum {minv} MW \n@ {min_day}"),
              hjust = 0,
              vjust = 1.5)
```


```{r, EGAT-sale-to-MEA-2019, echo=FALSE, fig.cap='EGAT electricity sale profile to MEA in 2019.', fig.align='center', out.width= '90%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

Outputs are saved. Outputs are listed as follows:

* Create a file name `mea_egtsle_2019.png`
* Save a plot in a directory using `ggsave()` [function](https://ggplot2.tidyverse.org/reference/ggsave.html)
* Save profile data in a `profiledata` list
* Save figures in a `profilefigure` list
* Save summary data in a `summarydata` list
```{r, save output}

outputfigure <- paste0(outfigdir, "mea_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("mea_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_egtsle_2019" = summary))
```

### The 2019 Provincial Electricity Authority (PEA) EGAT sale profiles {#peaegtsle2019}
#### The 2019 PEA-R1 (Central region) EGAT sale profile
Read a profile data
```{r, profile_PEA-R1_egtsle2019, echo=TRUE}
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:E17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R1) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R1)
```

```{r profile-egat-to-pea-r1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R1 profile',
  booktabs = TRUE
)
```


```{r, summary_PEA-R1_egtsle2019}
maxv <- ceiling(max(profile$PEA_R1)) # Get a peak MW
minv <- floor(min(profile$PEA_R1)) # Get a min MW
energy <- sum(profile$PEA_R1)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R1 == max(PEA_R1)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R1 == min(PEA_R1)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) 
```

```{r sum-egat-to-PEA-R1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R1 in 2019',
  booktabs = TRUE
)
```

The 2019 electricity sale profile from EGAT to PEA-R1 is illustrated (see Figure \@ref(fig:EGAT-sale-to-PEA-R1-2019)).

```{r,plot_PEA-R1_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R1,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R1 (Central region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)
```

```{r,EGAT-sale-to-PEA-R1-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R1 in 2019.', fig.align='center', out.width= '90%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

```{r, sv_PEA-R1_egtsle2019}
outputfigure <- paste0(outfigdir, "pea_r1_central_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r1_central_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r1_central_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r1_central_egtsle_2019" = summary))
```

#### The 2019 PEA-R2 (North Eastern region) EGAT sale profile


```{r, profile_PEA-R2_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:F17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R2) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R2) #%>% 
# mutate(strdatetime = as.factor(strptime(glue("{year}-{month}-{day} {time}"), "%Y-%m-%d %H:%M:%S")))
```

```{r profile-egat-to-PEA-R2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R2 profile',
  booktabs = TRUE
)
```

```{r, summary_PEA-R2_egtsle2019}
# Summary data ####
maxv <- ceiling(max(profile$PEA_R2)) # Get a peak MW
minv <- floor(min(profile$PEA_R2)) # Get a min MW
energy <- sum(profile$PEA_R2)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R2 == max(PEA_R2)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R2 == min(PEA_R2)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r sum-egat-to-PEA-R2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R2 in 2019',
  booktabs = TRUE
)
```


```{r, plot_PEA-R2_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R2,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R2 (North Eastern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_r2_northeastern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r2_northeastern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r2_northeastern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r2_northeastern_egtsle_2019" = summary))
```

The 2019 electricity sale profile from EGAT to PEA-R2 is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R2-2019)).

```{r,EGAT-sale-to-PEA-R2-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 PEA-R3 (Southern region) EGAT sale profile

```{r, profile_PEA-R3_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:G17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R3) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R3) #%>% 
# mutate(strdatetime = as.factor(strptime(glue("{year}-{month}-{day} {time}"), "%Y-%m-%d %H:%M:%S")))
```

```{r profile-egat-to-PEA-R3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R3 profile',
  booktabs = TRUE
)
```

```{r, summary_PEA-R3_egtsle2019}

# Summary data ####
maxv <- ceiling(max(profile$PEA_R3)) # Get a peak MW
minv <- floor(min(profile$PEA_R3)) # Get a min MW
energy <- sum(profile$PEA_R3)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R3 == max(PEA_R3)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R3 == min(PEA_R3)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r sum-egat-to-PEA-R3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R3 in 2019',
  booktabs = TRUE
)
```

```{r, plot_PEA-R3_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R3,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R3 (Southern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_r3_southern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r3_southern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r3_southern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r3_southern_egtsle_2019" = summary))
```

The 2019 electricity sale profile from EGAT to PEA-R3 is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R3-2019)).

```{r,EGAT-sale-to-PEA-R3-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 PEA-R4 (Northern region) EGAT sale profile

```{r, profile_PEA-R4_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:H17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R4) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R4) #%>% 

```

```{r profile-egat-to-PEA-R4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R4 profile',
  booktabs = TRUE
)
```

```{r summary_PEA-R4_egtsle2019, echo=FALSE, tidy=FALSE }
# Summary data ####
maxv <- ceiling(max(profile$PEA_R4)) # Get a peak MW
minv <- floor(min(profile$PEA_R4)) # Get a min MW
energy <- sum(profile$PEA_R4)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R4 == max(PEA_R4)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R4 == min(PEA_R4)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-PEA-R4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R4 in 2019',
  booktabs = TRUE
)
```

```{r, plot_PEA-R4_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R4,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R4 (Northern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.2,1000),
                     limits = c(0, round(maxv, -3)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0.5,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_r4_northern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r4_northern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r4_northern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r4_northern_egtsle_2019" = summary))
```

The 2019 electricity sale profile from EGAT to PEA-R4 is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R4-2019)).

```{r,EGAT-sale-to-PEA-R4-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 PEA (All regions) EGAT sale profile

```{r profile_PEA_allregion_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:I17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA) 
```

```{r profile-egat-to-PEA-allregion-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA (all regions) profile',
  booktabs = TRUE
)
```

```{r summary_PEA-allreion_egtsle2019, echo=FALSE, tidy=FALSE }
# Summary data ####
maxv <- ceiling(max(profile$PEA)) # Get a peak MW
minv <- floor(min(profile$PEA)) # Get a min MW
energy <- sum(profile$PEA)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA == max(PEA)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA == min(PEA)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-PEA-allregion-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA (all regions) in 2019',
  booktabs = TRUE
)
```

```{r plot_PEA-allregion_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA (All regions) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_allregion_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_allregion_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_allregion_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_allregion_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA (all regions) is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-allregion-2019)).

```{r,EGAT-sale-to-PEA-allregion-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA (all regions) in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 Direct Customer (DC) EGAT sale profiles {#dcegtsle2019}
#### The 2019 DC in in PEA R1 (Central region) EGAT sale profiles

```{r profile_dcr1_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:J17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R1) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R1) #%>% 

```

```{r profile-egat-to-dcr1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R1 profile',
  booktabs = TRUE
)
```


```{r summary_dcr1_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R1)) # Get a peak MW
minv <- floor(min(profile$DCs_R1)) # Get a min MW
energy <- sum(profile$DCs_R1)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R1 == max(DCs_R1)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R1 == min(DCs_R1)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr1-2019, echo=TRUE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R1 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr1_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R1,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R1 (Central region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,100),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r1_central_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r1_central_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r1_central_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_r1_central_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R1 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR1-2019)).

```{r,EGAT-sale-to-DCR1-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA R2 (North Eastern region) EGAT sale profiles

```{r profile_dcr2_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:K17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R2) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R2) #%>% 

```

```{r profile-egat-to-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R2 profile',
  booktabs = TRUE
)
```

```{r summary_dcr2_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R2)) # Get a peak MW
minv <- floor(min(profile$DCs_R2)) # Get a min MW
energy <- sum(profile$DCs_R2)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R2 == max(DCs_R2)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs_R2 == min(DCs_R2)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R2 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr2_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R2,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R2 (North Eastern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,100),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r2_northeastern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r2_northeastern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r2_northeastern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_r2_northeastern_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R2 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR2-2019)).

```{r,EGAT-sale-to-DCR2-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA R3 (Southern region) EGAT sale profiles

```{r profile_dcr3_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:L17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R3) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R3) #%>% 

```

```{r profile-egat-to-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R3 profile',
  booktabs = TRUE
)
```

```{r summary_dcr3_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R3)) # Get a peak MW
minv <- floor(min(profile$DCs_R3)) # Get a min MW
energy <- sum(profile$DCs_R3)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R3 == max(DCs_R3)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs_R3 == min(DCs_R3)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R3 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr3_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R3,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R3 (Southern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2),100),
                     limits = c(0, round(maxv, -2))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r3_southern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r3_southern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r3_southern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_r3_southern_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R3 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR3-2019)).

```{r,EGAT-sale-to-DCR3-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA R4 (Northern region) EGAT sale profiles

```{r profile_dcr4_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:M17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R4) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R4) #%>% 

```

```{r profile-egat-to-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R4 profile',
  booktabs = TRUE
)
```

```{r summary_dcr4_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R4)) # Get a peak MW
minv <- floor(min(profile$DCs_R4)) # Get a min MW
energy <- sum(profile$DCs_R4)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R4 == max(DCs_R4)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs_R4 == min(DCs_R4)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R4 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr4_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R4,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R4 (Northern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-1),10),
                     limits = c(0, round(maxv, -1))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -1)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -1)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = -0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r4_northern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r4_northern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r4_northern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("dc_r4_northern_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R4 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR4-2019)).

```{r,EGAT-sale-to-DCR4-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA (All regions) EGAT sale profiles

```{r profile_dcallregions_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:N17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs) #%>% 
```

```{r profile-egat-to-dcallregions-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA (all regions) profile',
  booktabs = TRUE
)
```

```{r summary_dcallregion_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs)) # Get a peak MW
minv <- floor(min(profile$DCs)) # Get a min MW
energy <- sum(profile$DCs)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs == max(DCs)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs == min(DCs)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcallregions-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA (all regions) in 2019',
  booktabs = TRUE
)
```

```{r plot_dcallregions_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA (All regions) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,100),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5,
            vjust = 1.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_allregions_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_allregions_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_allregions_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_allregions_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA (all regions) is illustrated in Figure \@ref(fig:EGAT-sale-to-DCALLREG-2019)).

```{r,EGAT-sale-to-DCALLREG-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA (all regions) in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R1 & DC R1 (Central region) EGAT electrity sale profiles

The electricity profile in PEA region is combined the electricity profile in PEA regions (see section \@ref(peaegtsle2019)) and DC in PEA regions (see section \@ref(dcegtsle2019))

\begin{equation}
 Prf_{r,t,h}=\ Prf_{PEA,t,h} + Prf_{DC,t,h}
 (\#eq:prfPeaDcCal)
\end{equation} 

Where, $Prf_{r,t,h}$ denotes an calculated profile in region $r$, year $t$, and time $h$ (MW).\
$Prf_{PEA,t,h}$ denotes a profile in $PEA$ from each region in year $t$ at time $h$ (MW).\
$Prf_{DC,t,h}$ denotes a profile from direct customer ($DC$) in each PEA region in year $t$ at time $h$ (MW).

```{r profile_pear1&dcr1_egtsle2019}
# Profile data ####
profile <- 
  
  profiledata$pea_r1_central_egtsle_2019%>%
  mutate(dc_r1 = profiledata$dc_r1_central_egtsle_2019$DCs_R1,
         r1_egt_sle = PEA_R1 + dc_r1) %>% 
  select(-PEA_R1, -dc_r1)

```

```{r, profile-egat-to-pear1-dcr1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R1 and direct customer in PEA R1 profile',
  booktabs = TRUE
)
```

```{r summary_pear1&dcr1_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r1_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r1_egt_sle)) # Get a min MW
energy <- sum(profile$r1_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r1_egt_sle == max(r1_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r1_egt_sle == min(r1_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear1-dcr1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R1 and direct customer in PEA R1 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1&dcr1_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r1_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R1 & direct customers (Central region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = 0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1+dcr1_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1+dcr1_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r1+dcr1_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1+dcr1_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R1 and direct customer in PEA R1 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear1-dcr1-2019). The electricity EGAT sale profiles of PEA R1 and direct customer in PEA R1 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R1-2019) and \@ref(fig:EGAT-sale-to-DCR1-2019), respectively.

```{r, EGAT-sale-to-pear1-dcr1-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R1 and direct customer in PEA R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R2 & DC R2 (North Eastern region) EGAT electrity sale profiles

```{r profile_pear2&dcr2_egtsle2019}
# Profile data ####
profile <-

profiledata$pea_r2_northeastern_egtsle_2019%>%
  mutate(dc_r2 = profiledata$dc_r2_northeastern_egtsle_2019$DCs_R2,
         r2_egt_sle = PEA_R2 + dc_r2) %>% 
  select(-PEA_R2, -dc_r2)

```

```{r, profile-egat-to-pear2-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R2 and direct customer in PEA R2 profile',
  booktabs = TRUE
)
```

```{r summary_pear2&dcr2_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r2_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r2_egt_sle)) # Get a min MW
energy <- sum(profile$r2_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r2_egt_sle == max(r2_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r2_egt_sle == min(r2_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear2-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R2 and direct customer in PEA R2 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2&dcr2_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r2_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R2 & direct customers (Northern Eastern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = 0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2+dcr2_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2+dcr2_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r2+dcr2_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2+dcr2_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R2 and direct customer in PEA R2 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear2-dcr2-2019). The electricity EGAT sale profiles of PEA R2 and direct customer in PEA R2 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R2-2019) and \@ref(fig:EGAT-sale-to-DCR2-2019), respectively.

```{r, EGAT-sale-to-pear2-dcr2-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R2 and direct customer in PEA R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R3 & DC R3 (Southern region) EGAT electrity sale profiles

```{r profile_pear3&dcr3_egtsle2019}
profile <-
  
  profiledata$pea_r3_southern_egtsle_2019%>%
  mutate(dc_r3 = profiledata$dc_r3_southern_egtsle_2019$DCs_R3,
         r3_egt_sle = PEA_R3 + dc_r3) %>% 
  select(-PEA_R3, -dc_r3)

```

```{r, profile-egat-to-pear3-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R3 and direct customer in PEA R3 profile',
  booktabs = TRUE
)
```

```{r summary_pear3&dcr3_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r3_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r3_egt_sle)) # Get a min MW
energy <- sum(profile$r3_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r3_egt_sle == max(r3_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r3_egt_sle == min(r3_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear3-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R3 and direct customer in PEA R3 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3&dcr3_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r3_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R3 & direct customers (Southern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = 0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3+dcr3_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3+dcr3_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r3+dcr3_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3+dcr3_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R3 and direct customer in PEA R3 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear3-dcr3-2019). The electricity EGAT sale profiles of PEA R3 and direct customer in PEA R3 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R3-2019) and \@ref(fig:EGAT-sale-to-DCR3-2019), respectively.

```{r, EGAT-sale-to-pear3-dcr3-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R3 and direct customer in PEA R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R4 & DC R4 (Southern region) EGAT electrity sale profiles

```{r profile_pear4&dcr4_egtsle2019}
profile <-
  
  profiledata$pea_r4_northern_egtsle_2019%>%
  mutate(dc_r4 = profiledata$dc_r4_northern_egtsle_2019$DCs_R4,
         r4_egt_sle = PEA_R4 + dc_r4) %>% 
  select(-PEA_R4, -dc_r4)
```

```{r, profile-egat-to-pear4-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R4 and direct customer in PEA R4 profile',
  booktabs = TRUE
)
```

```{r summary_pear4&dcr4_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r4_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r4_egt_sle)) # Get a min MW
energy <- sum(profile$r4_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r4_egt_sle == max(r4_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r4_egt_sle == min(r4_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear4-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R4 and direct customer in PEA R4 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4&dcr4_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r4_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R4 & direct customers (Northern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.2,1000),
                     limits = c(0, round(maxv, -3)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4+dcr4_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4+dcr4_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r4+dcr4_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4+dcr4_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R4 and direct customer in PEA R4 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear4-dcr4-2019). The electricity EGAT sale profiles of PEA R4 and direct customer in PEA R4 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R4-2019) and \@ref(fig:EGAT-sale-to-DCR4-2019), respectively.

```{r, EGAT-sale-to-pear4-dcr4-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R4 and direct customer in PEA R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 EGAT electrity sale profiles
This section provides a combined EGAT electricity sale profile. The equation is given in equation \@ref(eq:prfEgtsleCal)

\begin{equation}
 EGTSLE_{t,h}=\ MEA_{t,h} + \sum_{i=1}^{4} (PEA_{i,t,h} + DC_{i,t,h}) 
 (\#eq:prfEgtsleCal)
\end{equation} 

Where, 
$EGTSLE_{t,h}$ denotes the electricity EGAT sale ($EGTSLE$) profile in year $t$ at time stamp $h$ (MW).\
$MEA_{t,h}$ denotes the electricity EGAT sale profile to $MEA$ in year $t$ at time stamp $h$ (MW).\
$PEA_{i,t,h}$ denotes the electricity EGAT sale profile to $PEA$ in region $i$ in year $t$ at time stamp $h$ (MW).\
$DC_{i,t,h}$ denotes the electricity EGAT sale profile to direct customer ($DC$) in region $i$ in year $t$ at time stamp $h$ (MW).

```{r egtsale_combined_2019}
profile <-
  
  profiledata$mea_egtsle_2019%>%
  mutate(r1_dc1 = profiledata$"r1+dcr1_egtsle_2019"$r1_egt_sle,
         r2_dc2 = profiledata$"r2+dcr2_egtsle_2019"$r2_egt_sle,
         r3_dc3 = profiledata$"r3+dcr3_egtsle_2019"$r3_egt_sle,
         r4_dc4 = profiledata$"r4+dcr4_egtsle_2019"$r4_egt_sle,
         egt_sle = MEA + r1_dc1 + r2_dc2 + r3_dc3 + r4_dc4)
          
```

```{r, profile-egtsale-combined-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 electricity EGAT sale profile',
  booktabs = TRUE
)
```

```{r summary_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$egt_sle)) # Get a peak MW
minv <- floor(min(profile$egt_sle)) # Get a min MW
energy <- sum(profile$egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(egt_sle == max(egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(egt_sle == min(egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egatsale-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale in 2019',
  booktabs = TRUE
)
```

```{r plot_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale (MEA&PEA&DCs) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_egtsle_2019" = summary))

```


The 2019 electricity EGAT sale profile is illustrated in Figure \@ref(fig:EGAT-sale-2019).

```{r, EGAT-sale-2019, echo=FALSE,fig.cap='EGAT electricity sale profile 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

<!--chapter:end:02.1-egatSaleProfiles.Rmd-->

## The electrity requirement profiles
### The 2019 MEA requirement profile
```{r, mea_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, MAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, MAC)
  
# Summary data ####
maxv <- ceiling(max(profile$MAC)) # Get a peak MW
minv <- floor(min(profile$MAC)) # Get a min MW
energy <- sum(profile$MAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(MAC == max(MAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(MAC == min(MAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor)
```

```{r, sum-meareq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_meareq2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = MAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("mea_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_requirement_2019" = summary))

```

The 2019 MEA requirement profile is illustrated in Figure \@ref(fig:MEA-REQ-2019).

```{r, MEA-REQ-2019, echo=FALSE,fig.cap='MEA electricity requirment profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```


###The 2019 PEA R1 (Central region) requirement for EGAT NET electricity generation profile 

```{r pear1_req_2019}

profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, CAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, CAC)

# Summary data ####
maxv <- ceiling(max(profile$CAC)) # Get a peak MW
minv <- floor(min(profile$CAC)) # Get a min MW
energy <- sum(profile$CAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(CAC == max(CAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(CAC == min(CAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear1req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R1 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1req2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = CAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R1 (Central region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1_central_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1_central_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r1_central_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1_central_requirement_2019" = summary))

```

The 2019 PEA R1 requirement profile is illustrated in Figure \@ref(fig:PEAR1-REQ-2019).

```{r, PEAR1-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R2 (North eastern region) requirement
```{r pear2_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, NEC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NEC)

# Summary data ####
maxv <- ceiling(max(profile$NEC)) # Get a peak MW
minv <- floor(min(profile$NEC)) # Get a min MW
energy <- sum(profile$NEC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NEC == max(NEC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NEC == min(NEC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear2req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R2 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NEC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R2 (North Eastern region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2_northeastern_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2_northeastern_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r2_northeastern_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2_northeastern_requirement_2019" = summary))

```

The 2019 PEA R2 requirement profile is illustrated in Figure \@ref(fig:PEAR2-REQ-2019).

```{r, PEAR2-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R3 (Southern region) requirement
```{r pear3_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, SAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, SAC)

# Summary data ####
maxv <- ceiling(max(profile$SAC)) # Get a peak MW
minv <- floor(min(profile$SAC)) # Get a min MW
energy <- sum(profile$SAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(SAC == max(SAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(SAC == min(SAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear3req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R3 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = SAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R3 (Southern region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.4),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3_southern_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3_southern_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r3_southern_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3_southern_requirement_2019" = summary))

```

The 2019 PEA R3 requirement profile is illustrated in Figure \@ref(fig:PEAR3-REQ-2019).

```{r, PEAR3-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R4 (Northern region) requirement
```{r pear4_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, NAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NAC)

# Summary data ####
maxv <- ceiling(max(profile$NAC)) # Get a peak MW
minv <- floor(min(profile$NAC)) # Get a min MW
energy <- sum(profile$NAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NAC == max(NAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NAC == min(NAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear4req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R4 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R4 (Northern region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.4,1000),
                     limits = c(0, round(maxv, -3)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.4),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 2.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4_northern_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4_northern_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r4_northern_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4_northern_requirement_2019" = summary))

```

The 2019 PEA R4 requirement profile is illustrated in Figure \@ref(fig:PEAR4-REQ-2019).

```{r, PEAR4-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 Export TNB (Export to Malaysia) requirement

```{r tnb_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = "Date/Time", export_tnb = "Export TNB") %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, export_tnb)

# Summary data ####
maxv <- ceiling(max(profile$export_tnb)) # Get a peak MW
minv <- floor(min(profile$export_tnb)) # Get a min MW
energy <- sum(profile$export_tnb)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(export_tnb == max(export_tnb)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(export_tnb == min(export_tnb)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-tnbreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a TNB requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_tnbreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = export_tnb,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Export to TNB (Malaysia) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-1)*1.2,50),
                     limits = c(0, round(maxv, -1)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -1)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -1)*1.2),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "export_TNB_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("export_TNB_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("export_TNB_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_export_TNB_requirement_2019" = summary))
```

The 2019 TNB requirement profile is illustrated in Figure \@ref(fig:TNB-REQ-2019).

```{r, TNB-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from TNB in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 Export EDL (Export to Cambodia) requirement

```{r edl_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = "Date/Time", export_edl = "Export EDL") %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, export_edl)

# Summary data ####
maxv <- ceiling(max(profile$export_edl)) # Get a peak MW
minv <- floor(min(profile$export_edl)) # Get a min MW
energy <- sum(profile$export_edl)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(export_edl == max(export_edl)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(export_edl == min(export_edl)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-edlreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a EDL requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_edlreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = export_edl,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Export to EDL (Laos) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-1)*1.2,50),
                     limits = c(0, round(maxv, -1)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -1)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -1)*1.2),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "export_EDL_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("export_EDL_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("export_EDL_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_export_EDL_requirement_2019" = summary))

```

The 2019 EDL requirement profile is illustrated in Figure \@ref(fig:EDL-REQ-2019).

```{r, EDL-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from EDL in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R2 + Export EDL (North Eastern + Export to Cambodia) requirement

```{r r2edl_req_2019}
profile <-
  
  profiledata$r2_northeastern_requirement_2019 %>%
  mutate(export_edl = profiledata$export_EDL_requirement_2019$export_edl,
         r2_edl = NEC + export_edl) %>% 
  select(-NEC, -export_edl)

# Summary data ####
maxv <- ceiling(max(profile$r2_edl)) # Get a peak MW
minv <- floor(min(profile$r2_edl)) # Get a min MW
energy <- sum(profile$r2_edl)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r2_edl == max(r2_edl)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r2_edl == min(r2_edl)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-r2edlreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a R2 and EDL requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_r2edlreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r2_edl,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R2 & Export to EDL (Laos) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.3,1000),
                     limits = c(0, round(maxv, -3)*1.3)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2&export_EDL_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2&export_EDL_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r2&export_EDL_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2&export_EDL_requirement_2019" = summary))

```

The 2019 PEA R2 and EDL requirement profile is illustrated in Figure \@ref(fig:R2EDL-REQ-2019).

```{r, R2EDL-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R2 and EDL in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R3 + Export TNB (Southern + Export to Malaysia) requirement

```{r r3tnb_req_2019}
profile <-
  
  profiledata$r3_southern_requirement_2019 %>%
  mutate(export_tnb = profiledata$export_TNB_requirement_2019$export_tnb,
         r3_tnb = SAC + export_tnb) %>% 
  select(-SAC, -export_tnb)

# Summary data ####
maxv <- ceiling(max(profile$r3_tnb)) # Get a peak MW
minv <- floor(min(profile$r3_tnb)) # Get a min MW
energy <- sum(profile$r3_tnb)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r3_tnb == max(r3_tnb)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r3_tnb == min(r3_tnb)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-r3tnbreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a R3 and TNB requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_r3tnbreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r3_tnb,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R3 & Export to TNB (Malaysia) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.4,1000),
                     limits = c(0, round(maxv, -3)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3&export_TNB_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3&export_TNB_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r3&export_TNB_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3&export_TNB_requirement_2019" = summary))

```

The 2019 R3 and TNB requirement profile is illustrated in Figure \@ref(fig:R3TNB-REQ-2019).

```{r, R3TNB-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R3 and TNB in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 MEA + PEA R1 (MEA + CAC) requirement

```{r mear1_req_2019}
profile <-
  
  profiledata$mea_requirement_2019 %>%
  mutate(r1_requirement = profiledata$r1_central_requirement_2019$CAC,
         mea_r1 = MAC + r1_requirement) %>% 
  select(-MAC, -r1_requirement)

# Summary data ####
maxv <- ceiling(max(profile$mea_r1)) # Get a peak MW
minv <- floor(min(profile$mea_r1)) # Get a min MW
energy <- sum(profile$mea_r1)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(mea_r1 == max(mea_r1)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(mea_r1 == min(mea_r1)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-mear1req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA and PEA R1 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_meapear1req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = mea_r1,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA & R1 Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.4,1000),
                     limits = c(0, round(maxv, -3)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea&r1_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea&r1_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("mea&r1_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea&r1_requirement_2019" = summary))

```

The 2019 MEA and PEA R1 requirement profile is illustrated in Figure \@ref(fig:MEAPEAR1-REQ-2019).

```{r, MEAPEAR1-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from MEA and PEA R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 EGAT NET electricity generation profile

The EGAT net electricity generation profile is calculated by the summation of the electricity requirement in each region.

\begin{equation}
EGTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4} PEAReq_{i,t,h} + \sum_{c=1}^{2}EXPReq_{c,t,h}
(\#eq:egtNetGenCal)
\end{equation}

Where,
$EGTNETGEN_{i,t,h}$ denotes the EGAT net electricity generation ($EGTNETGEN$) profile in region $i$ in year $t$ at time stamp $h$ (MW).\
$MEAReq_{t,h}$ denotes the MEA requirement profile ($MEAReq$) in year $t$ at time stamp $h$ (MW).\
$PEAReq_{i,t,h}$ denotes the PEA requirement ($PEAReq$) profile in region $i$ in year $t$ at time stamp $h$ (MW).
$EXPReq_{c,t,h}$ denotes the electricity requirement from neighboring countries $c$ in year $t$ at time stamp $h$. 

```{r egt_ngn_2019}
profile <-
  
  profiledata$`mea&r1_requirement_2019` %>%
  mutate(r2_edl = profiledata$`r2&export_EDL_requirement_2019`$r2_edl,
         r3_tnb = profiledata$`r3&export_TNB_requirement_2019`$r3_tnb,
         r4_requirement = profiledata$r4_northern_requirement_2019$NAC,
         egt_netgen = mea_r1 + r2_edl + r3_tnb + r4_requirement) %>% 
  select(-mea_r1, -r2_edl, -r3_tnb, -r4_requirement)

# Summary data ####
maxv <- ceiling(max(profile$egt_netgen)) # Get a peak MW
minv <- floor(min(profile$egt_netgen)) # Get a min MW
energy <- sum(profile$egt_netgen)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(egt_netgen == max(egt_netgen)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(egt_netgen == min(egt_netgen)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egtngn-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a EGAT net generation profile in 2019',
  booktabs = TRUE
)
```

```{r plot_egtngn2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = egt_netgen,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT NET Electricity generation (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.05),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "egt_netgen_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("egt_netgen_2019" = profile))
profilefigure <- c(profilefigure, list("egt_netgen_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_egt_netgen_2019" = summary))
```

The 2019 EGAT net genration profile is illustrated in Figure \@ref(fig:EGT-NGN-2019).

```{r, EGT-NGN-2019, echo=FALSE,fig.cap='The EGAT net generation profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

<!--chapter:end:02.2-requirementProfiles.Rmd-->

# The transmission loss and use profiles
## The 2019 transmission loss and use profile

A transmissions loss profile is calculated from the difference between the EGAT net electricity generation and the EGAT electricity sale profile (see equation \@ref(eq:prfLossCal))

\begin{equation}

LSS_{i,t,h} = EGTNETGEN_{i,t,h} - EGTSLE_{i,t,h}
(\#eq:prfLossCal)

\end{equation}

Where,
$LSS_{i,t,h}$ denotes a transmission loss profile in region $i$ in year $t$ at time stamp $h$ (MW).\
$EGTNETGEN_{i,t,h}$ denotes a EGAT net generation profile in region $i$ in year $t$ at time stamp $h$ (MW) (see equation \@ref(eq:egtNetGenCal)).\
$EGTSLE_{i,t,h}$ denotes the electricity EGAT sale ($EGTSLE$) profile in year $t$ at time stamp $h$ (MW) (see equation \@ref(eq:prfEgtsleCal)). 

```{r transloss_2019}
profile <-
  
  profiledata$`egt_netgen_2019` %>%
  mutate(egt_sle = profiledata$egtsle_2019$egt_sle,
         tran_loss = egt_netgen - egt_sle) %>% 
  select(-egt_netgen, -egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$tran_loss)) # Get a peak MW
minv <- floor(min(profile$tran_loss)) # Get a min MW
energy <- sum(profile$tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(tran_loss == max(tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(tran_loss == min(tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a transmission loss profile in 2019',
  booktabs = TRUE
)
```

```{r plot_trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Transmission loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-3), round(maxv,-3)*1.2,200),
                     limits = c(round(minv,-3)*1.1, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.05),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_tran_loss_2019" = summary))

```

The 2019 transmission loss profile is illustrated in Figure \@ref(fig:TRTLOSS-2019).

```{r, TRTLOSS-2019, echo=FALSE,fig.cap='Transmission loss profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

###The 2019 MEA transmission loss and use profile

```{r meatransloss_2019}
profile <-
  
  profiledata$mea_requirement_2019 %>%
  mutate(mea_egt_sle = profiledata$mea_egtsle_2019$MEA,
         mea_tran_loss = MAC - mea_egt_sle) %>% 
  select(-MAC, -mea_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$mea_tran_loss)) # Get a peak MW
minv <- floor(min(profile$mea_tran_loss)) # Get a min MW
energy <- sum(profile$mea_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(mea_tran_loss == max(mea_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(mea_tran_loss == min(mea_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-meatrtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_meatrtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = mea_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA transmission loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-3), round(maxv,-3)*1.2,200),
                     limits = c(round(minv,-3)*1.1, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.8,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("mea_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_tran_loss_2019" = summary))

```

The 2019 MEA transmission loss and use profile is illustrated in Figure \@ref(fig:MEATRTLOSS-2019).

```{r, MEATRTLOSS-2019, echo=FALSE,fig.cap='The MEA transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R1 (Central region) transmission loss and use profile

```{r pear1transloss_2019}
profile <-
  
  profiledata$r1_central_requirement_2019 %>%
  mutate(r1_egt_sle = profiledata$`r1+dcr1_egtsle_2019`$r1_egt_sle,
         r1_tran_loss = CAC - r1_egt_sle) %>% 
  select(-CAC, -r1_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r1_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r1_tran_loss)) # Get a min MW
energy <- sum(profile$r1_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r1_tran_loss == max(r1_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r1_tran_loss == min(r1_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor)
```

```{r, sum-pear1trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R1 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r1_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R1 (Central region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-3), round(maxv,-2)*1.1,200),
                     limits = c(round(minv,-2)*1.1, round(maxv, -2)*2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.4),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = -0.1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.9)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r1_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1_tran_loss_2019" = summary))
```

The 2019 PEA R1 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR1TRTLOSS-2019).

```{r, PEAR1TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R1 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R2 (North Eastern region) transmission loss and use profile

```{r pear2transloss_2019}
profile <-
  
  profiledata$`r2&export_EDL_requirement_2019` %>%
  mutate(r2_egt_sle = profiledata$`r2+dcr2_egtsle_2019`$r2_egt_sle,
         r2_tran_loss = r2_edl - r2_egt_sle) %>% 
  select(-r2_edl, -r2_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r2_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r2_tran_loss)) # Get a min MW
energy <- sum(profile$r2_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r2_tran_loss == max(r2_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r2_tran_loss == min(r2_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-pear2trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R2 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r2_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R2 (North Eastern region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-2), round(maxv,-2)*1.3,200),
                     limits = c(round(minv,-2)*1.1, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 8.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r2_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2_tran_loss_2019" = summary))
```

The 2019 PEA R2 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR2TRTLOSS-2019).

```{r, PEAR2TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R2 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R3 (Southern region) transmission loss and use profile

```{r pear3transloss_2019}
profile <-
  
  profiledata$`r3&export_TNB_requirement_2019`%>%
  mutate(r3_egt_sle = profiledata$`r3+dcr3_egtsle_2019`$r3_egt_sle,
         r3_tran_loss = r3_tnb - r3_egt_sle) %>% 
  select(-r3_tnb, -r3_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r3_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r3_tran_loss)) # Get a min MW
energy <- sum(profile$r3_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r3_tran_loss == max(r3_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r3_tran_loss == min(r3_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear3trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R3 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r3_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R3 (Southern region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-2), round(maxv,-2)*2,200),
                     limits = c(round(minv,-2)*2, round(maxv, -2)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r3_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3_tran_loss_2019" = summary))
```

The 2019 PEA R3 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR3TRTLOSS-2019).

```{r, PEAR3TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R3 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R4 (Northern region) transmission loss and use profile 

```{r pear4transloss_2019}
profile <-
  
  profiledata$r4_northern_requirement_2019%>%
  mutate(r4_egt_sle = profiledata$`r4+dcr4_egtsle_2019`$r4_egt_sle,
         r4_tran_loss = NAC - r4_egt_sle) %>% 
  select(-NAC, -r4_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r4_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r4_tran_loss)) # Get a min MW
energy <- sum(profile$r4_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r4_tran_loss == max(r4_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r4_tran_loss == min(r4_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear4trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R4 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r4_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R4 (Northern region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-2), round(maxv,-2)*2,200),
                     limits = c(round(minv,-2)*1.2, round(maxv, -2)*1.3)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 3) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 9)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r4_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4_tran_loss_2019" = summary))
```

The 2019 PEA R4 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR4TRTLOSS-2019).

```{r, PEAR4TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R4 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```


<!--chapter:end:03.1-transLoss.Rmd-->

# Total net generation requirement profile

Total net electricity net generation requirement is calculated by the summation of an electricity requirement and VSPP in each region as given in equation \@ref(eq:totalNetGenCal). 


\begin{equation}

TOTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4}(PEAReq_{i,t,h} + VSPP_{i,t,h})
(\#eq:totalNetGenCal)

\end{equation}

Where,
$TOT_NET_GEN_{i,t,h}$ denotes total net electricity generation requirement in region $i$ in year $t$ at time stamp $h$ (MW).\
$MEAReq_{t,h}$ denotes the MEA requirement profile in year $t$ at time stamp $h$ (MW).\
$PEAReq_{i,t,h}$ denotes the PEA requirement profile in region $i$ in year $t$ at time stamp $h$ (MW).\
$VSPP_{i,t,h}$ denotes the electricity generation from $VSPP$ in region $i$ in year $t$ at time stamp $h$ (MW).\

## The 2019 MEA Total net generation requirement profile

```{r meatotnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, MAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, MAC)

# Summary data ####
maxv <- ceiling(max(profile$MAC)) # Get a peak MW
minv <- floor(min(profile$MAC)) # Get a min MW
energy <- sum(profile$MAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(MAC == max(MAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(MAC == min(MAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-meatotnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA total net electricity generation profile in 2019',
  booktabs = TRUE
)
```

```{r plot_meatotnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = MAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,1000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 3) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("mea_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_total_netgen_req_2019" = summary))

```

The 2019 MEA total net electricity generation is illustrated in Figure \@ref(fig:MEA-TOTNETGEN-2019).

```{r, MEA-TOTNETGEN-2019, echo=FALSE,fig.cap='The MEA total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R1 (Central region) total net generation requirement profile

```{r pear1totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, CAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, CAC)

# Summary data ####
maxv <- ceiling(max(profile$CAC)) # Get a peak MW
minv <- floor(min(profile$CAC)) # Get a min MW
energy <- sum(profile$CAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(CAC == max(CAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(CAC == min(CAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear1totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R1 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = CAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R1 (Central region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,1000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r1_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R1 is illustrated in Figure \@ref(fig:PEAR1-TOTNETGEN-2019).

```{r, PEAR1-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R1 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R2 (North Eastern region) total net generation requirement profile

```{r pear2totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, NEC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NEC)

# Summary data ####
maxv <- ceiling(max(profile$NEC)) # Get a peak MW
minv <- floor(min(profile$NEC)) # Get a min MW
energy <- sum(profile$NEC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NEC == max(NEC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NEC == min(NEC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear2totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R2 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NEC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R2 (North Eastern region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,1000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = -1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r2_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R2 is illustrated in Figure \@ref(fig:PEAR2-TOTNETGEN-2019).

```{r, PEAR2-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R2 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R3 (Southern region) total net generation requirement profile

```{r pear3totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, SAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, SAC)

# Summary data ####
maxv <- ceiling(max(profile$SAC)) # Get a peak MW
minv <- floor(min(profile$SAC)) # Get a min MW
energy <- sum(profile$SAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(SAC == max(SAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(SAC == min(SAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-pear3totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R3 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = SAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R3 (Southern region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,500),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = -1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r3_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R3 is illustrated in Figure \@ref(fig:PEAR3-TOTNETGEN-2019).

```{r, PEAR3-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R3 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R4 (Northern region) total net generation requirement profile

```{r pear4totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, NAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NAC)

# Summary data ####
maxv <- ceiling(max(profile$NAC)) # Get a peak MW
minv <- floor(min(profile$NAC)) # Get a min MW
energy <- sum(profile$NAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NAC == max(NAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NAC == min(NAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-pear4totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R4 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R4 (Northern region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,500),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = -1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r4_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R4 is illustrated in Figure \@ref(fig:PEAR4-TOTNETGEN-2019).

```{r, PEAR4-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R4 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 Total net generation requirement profile

Total net electricity generation is calculated by the summation of total net electricity generation in MEA and PEA regions as given in equation \@ref(eq:totalNetGenCal).

```{r totnetgen_2019}
profile <-
  
  profiledata$mea_total_netgen_req_2019 %>% 
  mutate(cac_tot_netgen = profiledata$r1_total_netgen_req_2019$CAC,
         nec_tot_netgen = profiledata$r2_total_netgen_req_2019$NEC,
         sac_tot_netgen = profiledata$r3_total_netgen_req_2019$SAC,
         nac_tot_netgen = profiledata$r4_total_netgen_req_2019$NAC,
         tot_netgen_req = MAC + cac_tot_netgen + nec_tot_netgen + sac_tot_netgen + nac_tot_netgen) %>% 
  select(-MAC, -cac_tot_netgen, -nec_tot_netgen, -sac_tot_netgen, -nac_tot_netgen)

# Summary data ####
maxv <- ceiling(max(profile$tot_netgen_req)) # Get a peak MW
minv <- floor(min(profile$tot_netgen_req)) # Get a min MW
energy <- sum(profile$tot_netgen_req)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(tot_netgen_req == max(tot_netgen_req)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(tot_netgen_req == min(tot_netgen_req)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in 2019',
  booktabs = TRUE
)
```

```{r plot_totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = tot_netgen_req,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,2000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation is illustrated in Figure \@ref(fig:TOTNETGEN-2019).

```{r, TOTNETGEN-2019, echo=FALSE,fig.cap='Total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

<!--chapter:end:04.1-totalNetGen.Rmd-->

# Vary small power producer (VSPP) situation

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
```

```{r, mea_vspp_ene_ext, echo = TRUE, warning=FALSE, message=FALSE}
mea_vspp_ene_ext <-

read_excel("raw_data/01 EGAT_20Oct2022_งบ66 67_Final.xlsx",
           sheet = "I_Actual",
           range = "CE7:CM31",
           col_names = c("solar", "wind", "biomass", "biogas", "msw", "hydro", "enecrop", "cogen", "tot_vspp_gwh")) %>% 
  replace(is.na(.),0) %>% 
  mutate(year = 1997:2021,
         year_th = year + 543) %>% 
  select(year, year_th,everything()) %>%
  pivot_longer(-year&-year_th, names_to = "fuel", values_to = "mea_vspp_gwh")
```

```{r, vsppene-2019, echo=FALSE, fig.cap='Electricity generation from VSPP in 2019.', fig.align='center', out.width= '90%'}
mea_vspp_ene_ext %>% 
  filter(year >=2005) %>% 
  ggplot(aes(x = year, y = mea_vspp_gwh, group = fuel, color = fuel)) +
  geom_line(show.legend = FALSE) +
  facet_wrap(~fuel, scales = "free_y")+
  ThemeLine +
  labs(x = NULL,
       y = "Electricity generation from VSPP (GWh)")
```


<!--chapter:end:05-vsppextcal.Rmd-->

# List of equations {-}

Calculated energy (electricity) from sale profiles \@ref(eq:energycal)

\begin{equation}
 
 Ene_{t}=\frac{\sum_{h=1}^{17520} (Prf_{t,h})}{2*1000}
 (\#eq:energycal)

\end{equation}

Load factor \@ref(eq:loadfactorcal)

\begin{equation}

 LF_{t}=\frac{Energy_{t}}{Peak_{d,h} * 8760}*100 
 (\#eq:loadfactorcal)

\end{equation} 

Electricity profile in PEA region \@ref(eq:prfPeaDcCal)

\begin{equation}
 
 Prf_{r,t,h}=\ Prf_{PEA,t,h} + Prf_{DC,t,h}
 (\#eq:prfPeaDcCal)

\end{equation}

Electricity EGAT sale profile \@ref(eq:prfEgtsleCal)

\begin{equation}

 EGTSLE_{t,h}=\ MEA_{t,h} + \sum_{i=1}^{4} (PEA_{i,t,h} + DC_{i,t,h}) 
 (\#eq:prfEgtsleCal)

\end{equation}

EGAT net electricity generation profile \@ref(eq:egtNetGenCal)

\begin{equation}

EGTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4} PEAReq_{i,t,h} + \sum_{c=1}^{2}EXPReq_{c,t,h}
(\#eq:egtNetGenCal)

\end{equation}

Transmissions loss profile \@ref(eq:prfLossCal)

\begin{equation}

LSS_{i,t,h} = EGTNETGEN_{i,t,h} - EGTSLE_{i,t,h}
(\#eq:prfLossCal)

\end{equation}

Total net generation requirement profile \@ref(eq:totalNetGenCal)

\begin{equation}

TOTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4}(PEAReq_{i,t,h} + VSPP_{i,t,h})
(\#eq:totalNetGenCal)

\end{equation}

<!--chapter:end:06-listofeqns.Rmd-->

# List of figures {-}

| Figure name | Figure number |
| :-----------|:-------------:|
| Fuel consumption for electricity generation from 2017–2021 | \@ref(fig:fig-fuelelygen2017-2021) |
| EGAT electricity sale profile to MEA in 2019 | \@ref(fig:EGAT-sale-to-MEA-2019) |
| EGAT electricity sale profile to PEA-R1 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R1-2019) |
| EGAT electricity sale profile to PEA-R2 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R2-2019) |
| EGAT electricity sale profile to PEA-R3 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R3-2019) |
| EGAT electricity sale profile to PEA-R4 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R4-2019) |
| EGAT electricity sale profile to PEA (all regions) in 2019 | \@ref(fig:EGAT-sale-to-PEA-allregion-2019) |
| EGAT electricity sale profile to direct customer in PEA-R1 in 2019 | \@ref(fig:EGAT-sale-to-DCR1-2019) |
| EGAT electricity sale profile to direct customer in PEA-R2 in 2019 | \@ref(fig:EGAT-sale-to-DCR2-2019) |
| EGAT electricity sale profile to direct customer in PEA-R3 in 2019 | \@ref(fig:EGAT-sale-to-DCR3-2019) |
| EGAT electricity sale profile to direct customer in PEA-R4 in 2019 | \@ref(fig:EGAT-sale-to-DCR4-2019) |
| EGAT electricity sale profile to direct customer in PEA (all regions) in 2019 | \@ref(fig:EGAT-sale-to-DCALLREG-2019)|
| EGAT electricity sale profile to PEA R1 and direct customer in PEA R1 in 2019 | \@ref(fig:EGAT-sale-to-pear1-dcr1-2019) |
| EGAT electricity sale profile to PEA R2 and direct customer in PEA R2 in 2019 | \@ref(fig:EGAT-sale-to-pear2-dcr2-2019) |
| EGAT electricity sale profile to PEA R3 and direct customer in PEA R3 in 2019 | \@ref(fig:EGAT-sale-to-pear3-dcr3-2019) |
| EGAT electricity sale profile to PEA R4 and direct customer in PEA R4 in 2019 | \@ref(fig:EGAT-sale-to-pear4-dcr4-2019) |
| EGAT electricity sale profile 2019 | \@ref(fig:EGAT-sale-2019) |
| MEA electricity requirement profile in 2019 | \@ref(fig:MEA-REQ-2019) |
| The electricity requirement profile from PEA R1 in 2019 | \@ref(fig:PEAR1-REQ-2019) |
| The electricity requirement profile from PEA R2 in 2019 | \@ref(fig:PEAR2-REQ-2019) |
| The electricity requirement profile from PEA R3 in 2019 | \@ref(fig:PEAR3-REQ-2019) |
| The electricity requirement profile from PEA R4 in 2019 | \@ref(fig:PEAR4-REQ-2019) |
| The electricity requirement profile from TNB in 2019 | \@ref(fig:TNB-REQ-2019) |
| The electricity requirement profile from EDL in 2019 | \@ref(fig:EDL-REQ-2019) |
| The electricity requirement profile from PEA R2 and EDL in 2019 | \@ref(fig:R2EDL-REQ-2019) |
| The electricity requirement profile from PEA R3 and TNB in 2019 | \@ref(fig:R3TNB-REQ-2019) |
| The electricity requirement profile from MEA and PEA R1 in 2019 | \@ref(fig:MEAPEAR1-REQ-2019) |
| The EGAT net generation profile in 2019 | \@ref(fig:EGT-NGN-2019) |
| Transmission loss profile in 2019 | \@ref(fig:TRTLOSS-2019) |
| The MEA transmission loss and use profile in 2019 | \@ref(fig:MEATRTLOSS-2019) |
| The PEA R1 transmission loss and use profile in 2019 | \@ref(fig:PEAR1TRTLOSS-2019) |
| The PEA R2 transmission loss and use profile in 2019 | \@ref(fig:PEAR2TRTLOSS-2019) |
| The PEA R3 transmission loss and use profile in 2019 | \@ref(fig:PEAR3TRTLOSS-2019) |
| The PEA R4 transmission loss and use profile in 2019 | \@ref(fig:PEAR4TRTLOSS-2019) |
| The MEA total net electricity generation requirement in 2019 | \@ref(fig:MEA-TOTNETGEN-2019) |
| The PEA R1 total net electricity generation requirement in 2019 | \@ref(fig:PEAR1-TOTNETGEN-2019) |
| The PEA R2 total net electricity generation requirement in 2019 | \@ref(fig:PEAR2-TOTNETGEN-2019) |
| The PEA R3 total net electricity generation requirement in 2019 | \@ref(fig:PEAR3-TOTNETGEN-2019) |
| The PEA R4 total net electricity generation requirement in 2019 | \@ref(fig:PEAR4-TOTNETGEN-2019) |
| Total net electricity generation requirement in 2019 | \@ref(fig:TOTNETGEN-2019) |

<!--chapter:end:07-listofFigures.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:08-references.Rmd-->

--- 
title: "Electricity Profiles Cloudbook: R technique"
author: "Puttipong Chunark, Ph.D."
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [report.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This is electricity profile cloudbook. This book provides the characteristic 
  of electricity profiles at all levels in Thailand. It gives the peak and
  and minimum load in (MW) and time. Load factor is calculated.
link-citations: yes
github-repo: PChunark/load_forecast_EGAT_strategies
---

# About {-}

This webpage is created to understand the electricity load profile at all 
levels. R coding techniques are included. Readers can learn how to code 
the R language in the format of scripts, R markdown, and bookdown.

<!--chapter:end:index.Rmd-->

# Introduction

```{r, library load, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
```

Electricity is one of the key final energy to drive an economy. It is used to provide enduse demands. For instance, charging electric vehicles (EVs), lighting houses, heating water and cooking, driving motors to convey products in industrial processes.

## Electricity consumption situation

The Department of Alternative Energy Development and Efficiency (DEDE) published the **"Energy Balance of Thailand 2021"**. The report provides Thailand's energy statistics in all sectors. In 2021, an electricity consumption (Final energy consumption) was 201,016 GWh [@dede2021]. Manufacturing industry consumed the highest electricity (see Table \@ref(tab:fnely2021)). It accounted for 39% of total electricity consumption in 2021. Commercial and residential sectors were the second and the third largest electricity consumption. They accounted for 33% and 27%. The rest were mining (0.6%), agriculture (0.2%) and transport sectors (0.1%). Further energy statistics can be found in the report on page 57, "Thailand energy commodity account 2021".


```{r, fnely2021, echo=FALSE, warning=FALSE, message=FALSE}
knitr::kable(
  tibble(Sector = c("Agriculture", "Mining", "Manufac. industry", "Construction", 
                  "Residential", "Commercial", "Transport (Road)", "Transport (Rail)"),
       "Electricity (GWh)" = c(398, 1279, 78919, "na", 54481, 65718, 1, 220)), 
  caption = "Electricity consumption in 2021",
  booktabs = TRUE
)
```

## Electricity generation situation

The electricity generation was 186,699 GWh in 2021. The exported and imported electricity were 33,356 GWh and 1,996 GWh. The electricity losses and own uses were 14,098 GWh and 2,945 GWh. Natural gas combined cycle power plants accounted for 59% of total electricity generation in 2021. Thermal power plants accounted for 30%. Table \@ref(tab:elygen2021) gives the electricity generation by power plant in 2021.

```{r, elygen2021, echo=FALSE, warning=FALSE, message=FALSE}
knitr::kable(
  tibble("Power plant type" = c("Hydro", "Thermal", "Gas turbine", "Combined cycle", 
                  "Diesel", "Gas engine", "Others", "Total"),
       "Electricity (GWh)" = c(4682, 56737, 1318, 110597, 28, 4769, 8568, 186699)), 
  caption = "Electricity generation in 2021",
  booktabs = TRUE
)
```


Coal & its products consumption rapidly decreased in generating an electricity from 2017-2021.
Solar and wind played a vital role in producing an electricity (see Figure \@ref(fig:fig-fuelelygen2017-2021)). The unit of COAL & ITS PRODUCTS, paddy husk, bagasses, agricultural waste and MSW are **thousand ton**. The unit of PETROLEUM PRODUCTS's and NATURAL GAS are **million litres (M.Litres)** and **MMscf.**, respectively. The electricity generation from solar, wind, small hydro power, large hydro power and geothermal, is reported in **GWh**. Biogas and OTHER energies are presented in **cubic meter (m^3^)** and **GJ**, respectively. 

```{r, tab_fuelelygen2017_2021, echo=FALSE, warning=FALSE, message=FALSE}

fuelelygen2017_2021<-
  tibble("Fuel type" = c("COAL & ITS PRODUCTS", "Anthracite", "Bituminous", "Lignite", "Briquettes & other coal",
                       "PETROLEUM PRODUCTS", "HSD", "Fuel oil",
                       "NATURAL GAS",
                       "RENEWABLE ENERGY", "Solar", "Wind", "Small hydro power", "Large hydro power", "Geothermal",
                       "Paddy husk", "Bagasse", "Agricultural waste", "MSW", 
                       "Biogas",
                       "OTHERS"),
       unit = c("thousand ton","thousand ton","thousand ton","thousand ton","thousand ton",
                "M.Litres","M.Litres","M.Litres",
                "MMscf.",
                NA, "GWh","GWh","GWh","GWh","GWh", 
                "thousand ton","thousand ton","thousand ton","thousand ton", 
                "m3",
                "GJ"),
       "2017" = c(21801, 0, 4964, 15898, 945,
                  72, 44, 28,
                  1108683,
                  NA, 4543, 1109, 504, 4329, 1, 
                  2455, 21602, 6520, 317, 
                  1060449427,
                  19982002),
       "2018" = c(20518, 0, 5333, 14169, 1016,
                  56, 40, 16,
                  1073831,
                  NA, 4537, 1641, 615, 7168, 1, 
                  2028, 24476, 7774, 580, 
                  1190465701,
                  21121440),
       "2019" = c(20052, 0, 5110, 13761, 1181,
                  66, 40, 26,
                  1059300,
                  NA, 5146, 3670, 441, 6005, 1, 
                  2105, 26835, 8617, 890, 
                  1319121140,
                  19842988),
       "2020" = c(19749, 0, 5286, 13223, 1240,
                  59, 30, 29,
                  1091779,
                  NA, 5031, 3220, 348, 4333, 1, 
                  2048, 23352, 8902, 1249, 
                  1054201606,
                  17228533),
       "2021" = c(20045,0,4698,14245,1102,
                  165,67,98,
                  1022759,
                  NA, 5015, 3552, 474, 4208, 1, 
                  2772, 24026, 9677, 1490, 
                  1161467101,
                  19251302)
        )
```

```{r, plot_fuelelygen2017_2021, echo=FALSE}

plot_fuelelygen2017_2021 <- 
fuelelygen2017_2021 %>% 
  pivot_longer(-c(`Fuel type`, unit ), names_to = "year") %>%
  filter(`Fuel type` != "RENEWABLE ENERGY") %>% 
  ggplot()+
  geom_line(aes(x = year, y = value, group = `Fuel type`, color = `Fuel type`),
            show.legend = FALSE)+
  facet_wrap(~`Fuel type`, scales = "free_y")+
  labs(x = NULL,
       y = "Fuel consumption (Physical units)")+
  theme_bw()+
  theme(strip.background=element_rect(fill="white", colour="white"),
    strip.text.x = element_text(size=7, colour = "black", angle = 0,face="bold"),
    axis.text.x=element_text(size = 10,angle=45, vjust=1.5, hjust=1, margin = unit(c(t = 0.3, r = 0, b = 0, l = 0), "cm")))
```

```{r, fig-fuelelygen2017-2021, echo=FALSE, fig.cap='Fuel consumption for electricity generation from 2017–2021.', fig.align='center', out.width= '90%'}
plot_fuelelygen2017_2021
```




## Initial settings
### Packages setting
Before the project starts, packages are required as follows:

* A `tidyverse` package is a bunch of packages to handle with a data analysis (for more information click [here](https://www.tidyverse.org/packages/)). It consists of data manipulation and visualization as follows:
  * A `ggplot2` [package](https://ggplot2.tidyverse.org/) is for data visualization.
  * A `dplyr` [package](https://dplyr.tidyverse.org/) is for data manipulation.
  * A `tidyr` [package](https://tidyr.tidyverse.org/) is for data tidying.
  * A `readr` [package](https://readr.tidyverse.org/) is for data import.
  * A `purrr` [package](https://purrr.tidyverse.org/) is for functional programming.
  * A `tibble` [package](https://tibble.tidyverse.org/) is a modern reimagining of the data.frame.
  * A `stringr` [package](https://github.com/tidyverse/stringr) is for strings.
  * A `forcats` [package](https://github.com/tidyverse/forcats) is for factors.
  * A `lubridate` [package](https://github.com/tidyverse/lubridate) is for date and time.
* A `readxl` [package](https://readxl.tidyverse.org/) is used for read data from **Excel** into R.
* A `scales` [package](https://scales.r-lib.org/) is applied to scale plots in the ggplot2 package.
* A `glue` [package](https://glue.tidyverse.org/) interprets strings literal. The package embeds R expressions and inserts into argument string.
* A `knitr` [package](https://github.com/yihui/knitr) is a lightweight API's designed to give users full control of the output without heavy coding work. In this project, the package is used for making a HTML. 

```{r, library setting, results='hide', message=FALSE}
library(tidyverse) #For data manipulation
library(readxl) #For reading the excel sheet
library(scales)
library(glue)
library(knitr)
library(plotly)
```
### Theme setting
Theme and lines for figures are set in a variable named `Themeline` as follows:

* `theme_bw()` [function](https://ggplot2.tidyverse.org/reference/ggtheme.html) provides a black and white theme.
* `theme()` function applied for setting theme and line represented in plots.
* `linepalette1` and `linepalette1` variables set line colors.

```{r, theme setting, results='hide', message=FALSE, warning=FALSE}
ThemeLine <- 
  theme_bw() +
  theme(
    panel.border=element_rect(fill=NA),
    panel.grid.minor = element_line(color = NA), 
    #    axis.title=element_text(size=5),
    #    axis.text.x = element_text(hjust=1,size = 10, angle = 0),
    axis.line=element_line(colour="black"),
    panel.background=element_rect(fill = "white"),
    panel.grid.major.x=element_line(linetype="dashed",colour="grey",linewidth = 0.5),
    panel.grid.major.y = element_blank(),
    # panel.grid.major=element_blank(),
    strip.background=element_rect(fill="white", colour="white"),
    strip.text.x = element_text(size=10, colour = "black", angle = 0,face="bold"),
    axis.text.x=element_text(size = 10,angle=45, vjust=0.9, hjust=1, margin = unit(c(t = 0.3, r = 0, b = 0, l = 0), "cm")),
    axis.text.y=element_text(size = 10,margin = unit(c(t = 0, r = 0.3, b = 0, l = 0), "cm")),
    legend.text = element_text(size = 10),
    legend.title = element_text(size = 10),
    axis.ticks.length=unit(-0.15,"cm")
  )
linepalette1 <- c("#4DAF4A","#FF7F00","#377EB8","#E41A1C","#984EA3","#F781BF","#8DD3C7","#FB8072","#80B1D3","#FDB462","#B3DE69","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F","#7f878f","#A65628","#FFFF33")
linepalette2 <- c("#E41A1C","#FF7F00","#377EB8","#B3DE69","#4DAF4A","#984EA3","#F781BF","#8DD3C7","#FB8072","#80B1D3","#FDB462","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F","#7f878f","#A65628","#FFFF33")

```
### Directory setting
Lists are create to store variables.

```{r, make list}
#----- Make a list of profile to store data -----####

profiledata <- list()
profilefigure <- list()
summarydata <- list()
```

```{r, variable for output}
#----- Make variable for output directory -----####
outfigdir <- c("figures/")
```

<!--chapter:end:01.1-intro.Rmd-->

# Electricity profiles 
This chapter provides electricity profiles and a R coding technique. 
Electricity profiles are illustrated to give an insight into profile behavior. 
R coding technique are given in order to understand the process flow and 
manage the big data obtained from several sources in the organization.

## The EGAT electrity sale profiles

### The 2019 Metropolitan Electricity Authority (MEA) EGAT sale profile
The electricity sale profile from EGAT is given by the Power System Control and Operation Division (ฝ่ายควบคุมระบบกำลังไฟฟ้า).


```{r, MEA EGAT sale}
#----- The 2019 MEA EGAT sale profile ----####
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
           sheet = "Load Curve",
           range = "C3:D17523"
            ) %>% 
  select(datetime = `Date/Time`, MEA) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, MEA)
```

```{r profile-egat-to-mea-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to MEA profile',
  booktabs = TRUE
)
```

The peak, minimun in the unit of MW, and an electricity sale to MEA in GWh from the profile are calculated.
The electricity sale to MEA (in GWh) is calculated by the summation of profile in MW divided by 2000.

The reason to divide by **2,000** is that the profile is given a time stamp in **every 30-min**. There are **17,520** values. Therefore, the profile is divided by **2** to get the results in **every 1 hr.**. We divided the output by **1,000** to convert the unit **from MWh to GWh** (see equation \@ref(eq:energycal)).

\begin{equation}
 Ene_{t}=\frac{\sum_{h=1}^{17520} (Prf_{t,h})}{2*1000}
 (\#eq:energycal)
\end{equation} 

Where, $Ene_{t}$ denotes an calculated energy (electricity) in year $t$.\
$Prf_{t,h}$ denotes a profile ($Prf$) in the unit of MW in year $t$ at a time stamp $h$.\
$h$ denotes a time stamp in a 30-minute interval. Therefore, there are **17,520 intervals** in a year (8,760 hrs.).

```{r, find peak and min MW}
# Summary data ####
maxv <- ceiling(max(profile$MEA)) # Get a peak MW
minv <- floor(min(profile$MEA)) # Get a min MW
energy <- sum(profile$MEA)/2000 # Calculate the energy
```

The peak and minimum MW days are also needed to assess in order to provide the maximum and minimum a saled electricity from EGAT to MEA.
```{r, peak & min day}
peak_day <- profile %>% #Find a peak day
            group_by(year) %>% 
            filter(MEA == max(MEA)) %>% 
            pull(datetime)
min_day <- profile %>% #Find a peak day
           group_by(year) %>% 
           filter(MEA == min(MEA)) %>% 
           pull(datetime)
```

Load factor is calculated by the energy in equation \@ref(eq:energycal) divided a maximum energy. A maximum energy is **the peak multiplied by 8760 hours**. Result is presented in a percentage.

\begin{equation}
 LF_{t}=\frac{Energy_{t}}{Peak_{d,h} * 8760}*100 
 (\#eq:loadfactorcal)
\end{equation} 

Where, $LF_{t}$ denotes the load factor at year $t$ in percentage.\
$Energy_{t}$ denotes the calculated energy from equation \@ref(eq:energycal) at year $t$ in GWh.\
$Peak_{d,h}$ denotes the peak electricity sale on the date $d$ at time $h$.


```{r, load factor}
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
```

Create a table to store relevant data.
```{r, summary data}
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```
In 2019, the electricity sale to MEA by EGAT reached it peak **`r format(maxv, scientific=FALSE, big.mark = ",")`** MW on **`r peak_day`**. The energy (electricity) sale to MEA was **`r format(energy, scientific=FALSE, big.mark = ",")`** GWh.
The summary of the electricity sale to MEA by EGAT in 2019 is given in Table \@ref(tab:sum-egat-to-mea-2019).

```{r sum-egat-to-mea-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to MEA in 2019',
  booktabs = TRUE
)
```


The 2019 electricity sale profile from EGAT to MEA is illustrated (see Figure \@ref(fig:EGAT-sale-to-MEA-2019)).
```{r, EGAT sale to MEA in 2019}
profile_plot <-
    ggplot() + 
    geom_line(data=profile, 
              aes(x = datetime, 
                  y = MEA,
                  group = month,
                  color = as.factor(month)),
              show.legend = FALSE) +
    ThemeLine +
    labs(x = NULL,
         y = "EGAT sale to MEA (MW)")+
    scale_x_datetime(breaks=date_breaks("1 month"), 
                     labels=date_format("%b %y")) +
    scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                       limits = c(0, round(maxv, -3))) +  
    scale_color_manual(values = linepalette1) +
    geom_point(data=summary,
               aes(x = peak_day, y = peak_mw))+
    geom_text(data = summary,
              aes(x = peak_day, y = round(maxv, -3)),
              label = glue("Peak {maxv} MW \n@ {peak_day}"))+
    geom_point(data=summary,
               aes(x = min_day, y = min_mw))+
    geom_text(data = summary,
              aes(x = min_day, y = round(minv, -3)),
              label = glue("Minimum {minv} MW \n@ {min_day}"),
              hjust = 0,
              vjust = 1.5)
```


```{r, EGAT-sale-to-MEA-2019, echo=FALSE, fig.cap='EGAT electricity sale profile to MEA in 2019.', fig.align='center', out.width= '90%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

Outputs are saved. Outputs are listed as follows:

* Create a file name `mea_egtsle_2019.png`
* Save a plot in a directory using `ggsave()` [function](https://ggplot2.tidyverse.org/reference/ggsave.html)
* Save profile data in a `profiledata` list
* Save figures in a `profilefigure` list
* Save summary data in a `summarydata` list
```{r, save output}

outputfigure <- paste0(outfigdir, "mea_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("mea_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_egtsle_2019" = summary))
```

### The 2019 Provincial Electricity Authority (PEA) EGAT sale profiles {#peaegtsle2019}
#### The 2019 PEA-R1 (Central region) EGAT sale profile
Read a profile data
```{r, profile_PEA-R1_egtsle2019, echo=TRUE}
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:E17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R1) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R1)
```

```{r profile-egat-to-pea-r1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R1 profile',
  booktabs = TRUE
)
```


```{r, summary_PEA-R1_egtsle2019}
maxv <- ceiling(max(profile$PEA_R1)) # Get a peak MW
minv <- floor(min(profile$PEA_R1)) # Get a min MW
energy <- sum(profile$PEA_R1)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R1 == max(PEA_R1)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R1 == min(PEA_R1)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) 
```

```{r sum-egat-to-PEA-R1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R1 in 2019',
  booktabs = TRUE
)
```

The 2019 electricity sale profile from EGAT to PEA-R1 is illustrated (see Figure \@ref(fig:EGAT-sale-to-PEA-R1-2019)).

```{r,plot_PEA-R1_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R1,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R1 (Central region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)
```

```{r,EGAT-sale-to-PEA-R1-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R1 in 2019.', fig.align='center', out.width= '90%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

```{r, sv_PEA-R1_egtsle2019}
outputfigure <- paste0(outfigdir, "pea_r1_central_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r1_central_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r1_central_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r1_central_egtsle_2019" = summary))
```

#### The 2019 PEA-R2 (North Eastern region) EGAT sale profile


```{r, profile_PEA-R2_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:F17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R2) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R2) #%>% 
# mutate(strdatetime = as.factor(strptime(glue("{year}-{month}-{day} {time}"), "%Y-%m-%d %H:%M:%S")))
```

```{r profile-egat-to-PEA-R2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R2 profile',
  booktabs = TRUE
)
```

```{r, summary_PEA-R2_egtsle2019}
# Summary data ####
maxv <- ceiling(max(profile$PEA_R2)) # Get a peak MW
minv <- floor(min(profile$PEA_R2)) # Get a min MW
energy <- sum(profile$PEA_R2)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R2 == max(PEA_R2)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R2 == min(PEA_R2)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r sum-egat-to-PEA-R2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R2 in 2019',
  booktabs = TRUE
)
```


```{r, plot_PEA-R2_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R2,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R2 (North Eastern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_r2_northeastern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r2_northeastern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r2_northeastern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r2_northeastern_egtsle_2019" = summary))
```

The 2019 electricity sale profile from EGAT to PEA-R2 is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R2-2019)).

```{r,EGAT-sale-to-PEA-R2-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 PEA-R3 (Southern region) EGAT sale profile

```{r, profile_PEA-R3_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:G17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R3) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R3) #%>% 
# mutate(strdatetime = as.factor(strptime(glue("{year}-{month}-{day} {time}"), "%Y-%m-%d %H:%M:%S")))
```

```{r profile-egat-to-PEA-R3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R3 profile',
  booktabs = TRUE
)
```

```{r, summary_PEA-R3_egtsle2019}

# Summary data ####
maxv <- ceiling(max(profile$PEA_R3)) # Get a peak MW
minv <- floor(min(profile$PEA_R3)) # Get a min MW
energy <- sum(profile$PEA_R3)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R3 == max(PEA_R3)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R3 == min(PEA_R3)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r sum-egat-to-PEA-R3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R3 in 2019',
  booktabs = TRUE
)
```

```{r, plot_PEA-R3_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R3,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R3 (Southern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_r3_southern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r3_southern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r3_southern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r3_southern_egtsle_2019" = summary))
```

The 2019 electricity sale profile from EGAT to PEA-R3 is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R3-2019)).

```{r,EGAT-sale-to-PEA-R3-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 PEA-R4 (Northern region) EGAT sale profile

```{r, profile_PEA-R4_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:H17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA_R4) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA_R4) #%>% 

```

```{r profile-egat-to-PEA-R4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R4 profile',
  booktabs = TRUE
)
```

```{r summary_PEA-R4_egtsle2019, echo=FALSE, tidy=FALSE }
# Summary data ####
maxv <- ceiling(max(profile$PEA_R4)) # Get a peak MW
minv <- floor(min(profile$PEA_R4)) # Get a min MW
energy <- sum(profile$PEA_R4)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R4 == max(PEA_R4)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA_R4 == min(PEA_R4)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-PEA-R4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R4 in 2019',
  booktabs = TRUE
)
```

```{r, plot_PEA-R4_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA_R4,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R4 (Northern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.2,1000),
                     limits = c(0, round(maxv, -3)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0.5,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_r4_northern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_r4_northern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_r4_northern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_r4_northern_egtsle_2019" = summary))
```

The 2019 electricity sale profile from EGAT to PEA-R4 is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R4-2019)).

```{r,EGAT-sale-to-PEA-R4-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA-R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 PEA (All regions) EGAT sale profile

```{r profile_PEA_allregion_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:I17523"
  ) %>% 
  select(datetime = `Date/Time`, PEA) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, PEA) 
```

```{r profile-egat-to-PEA-allregion-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA (all regions) profile',
  booktabs = TRUE
)
```

```{r summary_PEA-allreion_egtsle2019, echo=FALSE, tidy=FALSE }
# Summary data ####
maxv <- ceiling(max(profile$PEA)) # Get a peak MW
minv <- floor(min(profile$PEA)) # Get a min MW
energy <- sum(profile$PEA)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA == max(PEA)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(PEA == min(PEA)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-PEA-allregion-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA (all regions) in 2019',
  booktabs = TRUE
)
```

```{r plot_PEA-allregion_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = PEA,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA (All regions) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "pea_allregion_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("pea_allregion_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("pea_allregion_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_pea_allregion_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA (all regions) is illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-allregion-2019)).

```{r,EGAT-sale-to-PEA-allregion-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA (all regions) in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 Direct Customer (DC) EGAT sale profiles {#dcegtsle2019}
#### The 2019 DC in in PEA R1 (Central region) EGAT sale profiles

```{r profile_dcr1_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:J17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R1) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R1) #%>% 

```

```{r profile-egat-to-dcr1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R1 profile',
  booktabs = TRUE
)
```


```{r summary_dcr1_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R1)) # Get a peak MW
minv <- floor(min(profile$DCs_R1)) # Get a min MW
energy <- sum(profile$DCs_R1)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R1 == max(DCs_R1)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R1 == min(DCs_R1)) %>% 
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr1-2019, echo=TRUE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R1 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr1_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R1,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R1 (Central region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,100),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r1_central_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r1_central_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r1_central_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_r1_central_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R1 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR1-2019)).

```{r,EGAT-sale-to-DCR1-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA R2 (North Eastern region) EGAT sale profiles

```{r profile_dcr2_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:K17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R2) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R2) #%>% 

```

```{r profile-egat-to-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R2 profile',
  booktabs = TRUE
)
```

```{r summary_dcr2_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R2)) # Get a peak MW
minv <- floor(min(profile$DCs_R2)) # Get a min MW
energy <- sum(profile$DCs_R2)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R2 == max(DCs_R2)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs_R2 == min(DCs_R2)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R2 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr2_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R2,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R2 (North Eastern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,100),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r2_northeastern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r2_northeastern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r2_northeastern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_r2_northeastern_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R2 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR2-2019)).

```{r,EGAT-sale-to-DCR2-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA R3 (Southern region) EGAT sale profiles

```{r profile_dcr3_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:L17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R3) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R3) #%>% 

```

```{r profile-egat-to-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R3 profile',
  booktabs = TRUE
)
```

```{r summary_dcr3_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R3)) # Get a peak MW
minv <- floor(min(profile$DCs_R3)) # Get a min MW
energy <- sum(profile$DCs_R3)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R3 == max(DCs_R3)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs_R3 == min(DCs_R3)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R3 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr3_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R3,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R3 (Southern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2),100),
                     limits = c(0, round(maxv, -2))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"))+
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r3_southern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r3_southern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r3_southern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_r3_southern_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R3 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR3-2019)).

```{r,EGAT-sale-to-DCR3-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA R4 (Northern region) EGAT sale profiles

```{r profile_dcr4_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:M17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs_R4) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs_R4) #%>% 

```

```{r profile-egat-to-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA-R4 profile',
  booktabs = TRUE
)
```

```{r summary_dcr4_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs_R4)) # Get a peak MW
minv <- floor(min(profile$DCs_R4)) # Get a min MW
energy <- sum(profile$DCs_R4)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs_R4 == max(DCs_R4)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs_R4 == min(DCs_R4)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA-R4 in 2019',
  booktabs = TRUE
)
```

```{r plot_dcr4_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs_R4,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA R4 (Northern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-1),10),
                     limits = c(0, round(maxv, -1))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -1)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -1)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = -0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_r4_northern_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_r4_northern_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_r4_northern_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("dc_r4_northern_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA-R4 is illustrated in Figure \@ref(fig:EGAT-sale-to-DCR4-2019)).

```{r,EGAT-sale-to-DCR4-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA-R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

#### The 2019 DC in in PEA (All regions) EGAT sale profiles

```{r profile_dcallregions_egtsle2019}
# Profile data ####
profile <- 
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "C3:N17523"
  ) %>% 
  select(datetime = `Date/Time`, DCs) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, DCs) #%>% 
```

```{r profile-egat-to-dcallregions-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to direct customer in PEA (all regions) profile',
  booktabs = TRUE
)
```

```{r summary_dcallregion_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$DCs)) # Get a peak MW
minv <- floor(min(profile$DCs)) # Get a min MW
energy <- sum(profile$DCs)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(DCs == max(DCs)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(DCs == min(DCs)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r sum-egat-to-dcallregions-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to direct customer in PEA (all regions) in 2019',
  booktabs = TRUE
)
```

```{r plot_dcallregions_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = DCs,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to direct customers in PEA (All regions) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,100),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5,
            vjust = 1.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -2)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "dc_allregions_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("dc_allregions_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("dc_allregions_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_dc_allregions_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to direct customer in PEA (all regions) is illustrated in Figure \@ref(fig:EGAT-sale-to-DCALLREG-2019)).

```{r,EGAT-sale-to-DCALLREG-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to direct customer in PEA (all regions) in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R1 & DC R1 (Central region) EGAT electrity sale profiles

The electricity profile in PEA region is combined the electricity profile in PEA regions (see section \@ref(peaegtsle2019)) and DC in PEA regions (see section \@ref(dcegtsle2019))

\begin{equation}
 Prf_{r,t,h}=\ Prf_{PEA,t,h} + Prf_{DC,t,h}
 (\#eq:prfPeaDcCal)
\end{equation} 

Where, $Prf_{r,t,h}$ denotes an calculated profile in region $r$, year $t$, and time $h$ (MW).\
$Prf_{PEA,t,h}$ denotes a profile in $PEA$ from each region in year $t$ at time $h$ (MW).\
$Prf_{DC,t,h}$ denotes a profile from direct customer ($DC$) in each PEA region in year $t$ at time $h$ (MW).

```{r profile_pear1&dcr1_egtsle2019}
# Profile data ####
profile <- 
  
  profiledata$pea_r1_central_egtsle_2019%>%
  mutate(dc_r1 = profiledata$dc_r1_central_egtsle_2019$DCs_R1,
         r1_egt_sle = PEA_R1 + dc_r1) %>% 
  select(-PEA_R1, -dc_r1)

```

```{r, profile-egat-to-pear1-dcr1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R1 and direct customer in PEA R1 profile',
  booktabs = TRUE
)
```

```{r summary_pear1&dcr1_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r1_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r1_egt_sle)) # Get a min MW
energy <- sum(profile$r1_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r1_egt_sle == max(r1_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r1_egt_sle == min(r1_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear1-dcr1-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R1 and direct customer in PEA R1 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1&dcr1_egtsle2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r1_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R1 & direct customers (Central region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = 0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1+dcr1_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1+dcr1_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r1+dcr1_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1+dcr1_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R1 and direct customer in PEA R1 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear1-dcr1-2019). The electricity EGAT sale profiles of PEA R1 and direct customer in PEA R1 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R1-2019) and \@ref(fig:EGAT-sale-to-DCR1-2019), respectively.

```{r, EGAT-sale-to-pear1-dcr1-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R1 and direct customer in PEA R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R2 & DC R2 (North Eastern region) EGAT electrity sale profiles

```{r profile_pear2&dcr2_egtsle2019}
# Profile data ####
profile <-

profiledata$pea_r2_northeastern_egtsle_2019%>%
  mutate(dc_r2 = profiledata$dc_r2_northeastern_egtsle_2019$DCs_R2,
         r2_egt_sle = PEA_R2 + dc_r2) %>% 
  select(-PEA_R2, -dc_r2)

```

```{r, profile-egat-to-pear2-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R2 and direct customer in PEA R2 profile',
  booktabs = TRUE
)
```

```{r summary_pear2&dcr2_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r2_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r2_egt_sle)) # Get a min MW
energy <- sum(profile$r2_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r2_egt_sle == max(r2_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r2_egt_sle == min(r2_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear2-dcr2-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R2 and direct customer in PEA R2 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2&dcr2_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r2_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R2 & direct customers (Northern Eastern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = 0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2+dcr2_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2+dcr2_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r2+dcr2_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2+dcr2_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R2 and direct customer in PEA R2 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear2-dcr2-2019). The electricity EGAT sale profiles of PEA R2 and direct customer in PEA R2 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R2-2019) and \@ref(fig:EGAT-sale-to-DCR2-2019), respectively.

```{r, EGAT-sale-to-pear2-dcr2-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R2 and direct customer in PEA R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R3 & DC R3 (Southern region) EGAT electrity sale profiles

```{r profile_pear3&dcr3_egtsle2019}
profile <-
  
  profiledata$pea_r3_southern_egtsle_2019%>%
  mutate(dc_r3 = profiledata$dc_r3_southern_egtsle_2019$DCs_R3,
         r3_egt_sle = PEA_R3 + dc_r3) %>% 
  select(-PEA_R3, -dc_r3)

```

```{r, profile-egat-to-pear3-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R3 and direct customer in PEA R3 profile',
  booktabs = TRUE
)
```

```{r summary_pear3&dcr3_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r3_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r3_egt_sle)) # Get a min MW
energy <- sum(profile$r3_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r3_egt_sle == max(r3_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r3_egt_sle == min(r3_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear3-dcr3-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R3 and direct customer in PEA R3 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3&dcr3_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r3_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R3 & direct customers (Southern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3),1000),
                     limits = c(0, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = 0.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3+dcr3_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3+dcr3_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r3+dcr3_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3+dcr3_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R3 and direct customer in PEA R3 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear3-dcr3-2019). The electricity EGAT sale profiles of PEA R3 and direct customer in PEA R3 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R3-2019) and \@ref(fig:EGAT-sale-to-DCR3-2019), respectively.

```{r, EGAT-sale-to-pear3-dcr3-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R3 and direct customer in PEA R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R4 & DC R4 (Southern region) EGAT electrity sale profiles

```{r profile_pear4&dcr4_egtsle2019}
profile <-
  
  profiledata$pea_r4_northern_egtsle_2019%>%
  mutate(dc_r4 = profiledata$dc_r4_northern_egtsle_2019$DCs_R4,
         r4_egt_sle = PEA_R4 + dc_r4) %>% 
  select(-PEA_R4, -dc_r4)
```

```{r, profile-egat-to-pear4-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 EGAT sale to PEA R4 and direct customer in PEA R4 profile',
  booktabs = TRUE
)
```

```{r summary_pear4&dcr4_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$r4_egt_sle)) # Get a peak MW
minv <- floor(min(profile$r4_egt_sle)) # Get a min MW
energy <- sum(profile$r4_egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r4_egt_sle == max(r4_egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r4_egt_sle == min(r4_egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egat-to-pear4-dcr4-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale to PEA R4 and direct customer in PEA R4 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4&dcr4_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r4_egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale to PEA R4 & direct customers (Northern region) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.2,1000),
                     limits = c(0, round(maxv, -3)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4+dcr4_egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4+dcr4_egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("r4+dcr4_egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4+dcr4_egtsle_2019" = summary))

```

The 2019 electricity sale profile from EGAT to PEA R4 and direct customer in PEA R4 is illustrated in Figure \@ref(fig:EGAT-sale-to-pear4-dcr4-2019). The electricity EGAT sale profiles of PEA R4 and direct customer in PEA R4 are illustrated in Figure \@ref(fig:EGAT-sale-to-PEA-R4-2019) and \@ref(fig:EGAT-sale-to-DCR4-2019), respectively.

```{r, EGAT-sale-to-pear4-dcr4-2019, echo=FALSE,fig.cap='EGAT electricity sale profile to PEA R4 and direct customer in PEA R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 EGAT electrity sale profiles
This section provides a combined EGAT electricity sale profile. The equation is given in equation \@ref(eq:prfEgtsleCal)

\begin{equation}
 EGTSLE_{t,h}=\ MEA_{t,h} + \sum_{i=1}^{4} (PEA_{i,t,h} + DC_{i,t,h}) 
 (\#eq:prfEgtsleCal)
\end{equation} 

Where, 
$EGTSLE_{t,h}$ denotes the electricity EGAT sale ($EGTSLE$) profile in year $t$ at time stamp $h$ (MW).\
$MEA_{t,h}$ denotes the electricity EGAT sale profile to $MEA$ in year $t$ at time stamp $h$ (MW).\
$PEA_{i,t,h}$ denotes the electricity EGAT sale profile to $PEA$ in region $i$ in year $t$ at time stamp $h$ (MW).\
$DC_{i,t,h}$ denotes the electricity EGAT sale profile to direct customer ($DC$) in region $i$ in year $t$ at time stamp $h$ (MW).

```{r egtsale_combined_2019}
profile <-
  
  profiledata$mea_egtsle_2019%>%
  mutate(r1_dc1 = profiledata$"r1+dcr1_egtsle_2019"$r1_egt_sle,
         r2_dc2 = profiledata$"r2+dcr2_egtsle_2019"$r2_egt_sle,
         r3_dc3 = profiledata$"r3+dcr3_egtsle_2019"$r3_egt_sle,
         r4_dc4 = profiledata$"r4+dcr4_egtsle_2019"$r4_egt_sle,
         egt_sle = MEA + r1_dc1 + r2_dc2 + r3_dc3 + r4_dc4)
          
```

```{r, profile-egtsale-combined-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  head(profile,5), caption = 'The 2019 electricity EGAT sale profile',
  booktabs = TRUE
)
```

```{r summary_egtsle2019, echo=TRUE, tidy=FALSE}
# Summary data ####
maxv <- ceiling(max(profile$egt_sle)) # Get a peak MW
minv <- floor(min(profile$egt_sle)) # Get a min MW
energy <- sum(profile$egt_sle)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(egt_sle == max(egt_sle)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(egt_sle == min(egt_sle)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egatsale-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of EGAT sale in 2019',
  booktabs = TRUE
)
```

```{r plot_egtsle2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = egt_sle,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT sale (MEA&PEA&DCs) (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "egtsle_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("egtsle_2019" = profile))
profilefigure <- c(profilefigure, list("egtsle_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_egtsle_2019" = summary))

```


The 2019 electricity EGAT sale profile is illustrated in Figure \@ref(fig:EGAT-sale-2019).

```{r, EGAT-sale-2019, echo=FALSE,fig.cap='EGAT electricity sale profile 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

<!--chapter:end:02.1-egatSaleProfiles.Rmd-->

## The electrity requirement profiles
### The 2019 MEA requirement profile
```{r, mea_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, MAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, MAC)
  
# Summary data ####
maxv <- ceiling(max(profile$MAC)) # Get a peak MW
minv <- floor(min(profile$MAC)) # Get a min MW
energy <- sum(profile$MAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(MAC == max(MAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(MAC == min(MAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor)
```

```{r, sum-meareq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_meareq2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = MAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("mea_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_requirement_2019" = summary))

```

The 2019 MEA requirement profile is illustrated in Figure \@ref(fig:MEA-REQ-2019).

```{r, MEA-REQ-2019, echo=FALSE,fig.cap='MEA electricity requirment profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```


###The 2019 PEA R1 (Central region) requirement for EGAT NET electricity generation profile 

```{r pear1_req_2019}

profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, CAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, CAC)

# Summary data ####
maxv <- ceiling(max(profile$CAC)) # Get a peak MW
minv <- floor(min(profile$CAC)) # Get a min MW
energy <- sum(profile$CAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(CAC == max(CAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(CAC == min(CAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear1req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R1 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1req2019}
# Plot a profile ####

profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = CAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R1 (Central region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1_central_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1_central_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r1_central_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1_central_requirement_2019" = summary))

```

The 2019 PEA R1 requirement profile is illustrated in Figure \@ref(fig:PEAR1-REQ-2019).

```{r, PEAR1-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R2 (North eastern region) requirement
```{r pear2_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, NEC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NEC)

# Summary data ####
maxv <- ceiling(max(profile$NEC)) # Get a peak MW
minv <- floor(min(profile$NEC)) # Get a min MW
energy <- sum(profile$NEC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NEC == max(NEC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NEC == min(NEC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear2req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R2 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NEC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R2 (North Eastern region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.1),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2_northeastern_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2_northeastern_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r2_northeastern_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2_northeastern_requirement_2019" = summary))

```

The 2019 PEA R2 requirement profile is illustrated in Figure \@ref(fig:PEAR2-REQ-2019).

```{r, PEAR2-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R2 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R3 (Southern region) requirement
```{r pear3_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, SAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, SAC)

# Summary data ####
maxv <- ceiling(max(profile$SAC)) # Get a peak MW
minv <- floor(min(profile$SAC)) # Get a min MW
energy <- sum(profile$SAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(SAC == max(SAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(SAC == min(SAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear3req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R3 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = SAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R3 (Southern region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,1000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.4),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.1,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3_southern_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3_southern_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r3_southern_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3_southern_requirement_2019" = summary))

```

The 2019 PEA R3 requirement profile is illustrated in Figure \@ref(fig:PEAR3-REQ-2019).

```{r, PEAR3-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R3 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R4 (Northern region) requirement
```{r pear4_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = `Date/Time`, NAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NAC)

# Summary data ####
maxv <- ceiling(max(profile$NAC)) # Get a peak MW
minv <- floor(min(profile$NAC)) # Get a min MW
energy <- sum(profile$NAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NAC == max(NAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NAC == min(NAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear4req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R4 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R4 (Northern region) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.4,1000),
                     limits = c(0, round(maxv, -3)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*1.4),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 2.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4_northern_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4_northern_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r4_northern_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4_northern_requirement_2019" = summary))

```

The 2019 PEA R4 requirement profile is illustrated in Figure \@ref(fig:PEAR4-REQ-2019).

```{r, PEAR4-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R4 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 Export TNB (Export to Malaysia) requirement

```{r tnb_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = "Date/Time", export_tnb = "Export TNB") %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, export_tnb)

# Summary data ####
maxv <- ceiling(max(profile$export_tnb)) # Get a peak MW
minv <- floor(min(profile$export_tnb)) # Get a min MW
energy <- sum(profile$export_tnb)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(export_tnb == max(export_tnb)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(export_tnb == min(export_tnb)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-tnbreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a TNB requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_tnbreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = export_tnb,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Export to TNB (Malaysia) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-1)*1.2,50),
                     limits = c(0, round(maxv, -1)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -1)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -1)*1.2),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "export_TNB_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("export_TNB_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("export_TNB_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_export_TNB_requirement_2019" = summary))
```

The 2019 TNB requirement profile is illustrated in Figure \@ref(fig:TNB-REQ-2019).

```{r, TNB-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from TNB in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 Export EDL (Export to Cambodia) requirement

```{r edl_req_2019}
profile <-
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "AG3:AN17523"
  ) %>% 
  select(datetime = "Date/Time", export_edl = "Export EDL") %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, export_edl)

# Summary data ####
maxv <- ceiling(max(profile$export_edl)) # Get a peak MW
minv <- floor(min(profile$export_edl)) # Get a min MW
energy <- sum(profile$export_edl)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(export_edl == max(export_edl)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(export_edl == min(export_edl)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-edlreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a EDL requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_edlreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = export_edl,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Export to EDL (Laos) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-1)*1.2,50),
                     limits = c(0, round(maxv, -1)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -1)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -1)*1.2),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "export_EDL_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("export_EDL_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("export_EDL_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_export_EDL_requirement_2019" = summary))

```

The 2019 EDL requirement profile is illustrated in Figure \@ref(fig:EDL-REQ-2019).

```{r, EDL-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from EDL in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R2 + Export EDL (North Eastern + Export to Cambodia) requirement

```{r r2edl_req_2019}
profile <-
  
  profiledata$r2_northeastern_requirement_2019 %>%
  mutate(export_edl = profiledata$export_EDL_requirement_2019$export_edl,
         r2_edl = NEC + export_edl) %>% 
  select(-NEC, -export_edl)

# Summary data ####
maxv <- ceiling(max(profile$r2_edl)) # Get a peak MW
minv <- floor(min(profile$r2_edl)) # Get a min MW
energy <- sum(profile$r2_edl)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r2_edl == max(r2_edl)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r2_edl == min(r2_edl)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-r2edlreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a R2 and EDL requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_r2edlreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r2_edl,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R2 & Export to EDL (Laos) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.3,1000),
                     limits = c(0, round(maxv, -3)*1.3)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2&export_EDL_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2&export_EDL_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r2&export_EDL_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2&export_EDL_requirement_2019" = summary))

```

The 2019 PEA R2 and EDL requirement profile is illustrated in Figure \@ref(fig:R2EDL-REQ-2019).

```{r, R2EDL-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R2 and EDL in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA R3 + Export TNB (Southern + Export to Malaysia) requirement

```{r r3tnb_req_2019}
profile <-
  
  profiledata$r3_southern_requirement_2019 %>%
  mutate(export_tnb = profiledata$export_TNB_requirement_2019$export_tnb,
         r3_tnb = SAC + export_tnb) %>% 
  select(-SAC, -export_tnb)

# Summary data ####
maxv <- ceiling(max(profile$r3_tnb)) # Get a peak MW
minv <- floor(min(profile$r3_tnb)) # Get a min MW
energy <- sum(profile$r3_tnb)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r3_tnb == max(r3_tnb)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r3_tnb == min(r3_tnb)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-r3tnbreq-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a R3 and TNB requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_r3tnbreq2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r3_tnb,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R3 & Export to TNB (Malaysia) Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.4,1000),
                     limits = c(0, round(maxv, -3)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3&export_TNB_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3&export_TNB_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("r3&export_TNB_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3&export_TNB_requirement_2019" = summary))

```

The 2019 R3 and TNB requirement profile is illustrated in Figure \@ref(fig:R3TNB-REQ-2019).

```{r, R3TNB-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from PEA R3 and TNB in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 MEA + PEA R1 (MEA + CAC) requirement

```{r mear1_req_2019}
profile <-
  
  profiledata$mea_requirement_2019 %>%
  mutate(r1_requirement = profiledata$r1_central_requirement_2019$CAC,
         mea_r1 = MAC + r1_requirement) %>% 
  select(-MAC, -r1_requirement)

# Summary data ####
maxv <- ceiling(max(profile$mea_r1)) # Get a peak MW
minv <- floor(min(profile$mea_r1)) # Get a min MW
energy <- sum(profile$mea_r1)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(mea_r1 == max(mea_r1)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(mea_r1 == min(mea_r1)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-mear1req-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA and PEA R1 requirement in 2019',
  booktabs = TRUE
)
```

```{r plot_meapear1req2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = mea_r1,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA & R1 Electricity requirement (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.4,1000),
                     limits = c(0, round(maxv, -3)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.1),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea&r1_requirement_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea&r1_requirement_2019" = profile))
profilefigure <- c(profilefigure, list("mea&r1_requirement_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea&r1_requirement_2019" = summary))

```

The 2019 MEA and PEA R1 requirement profile is illustrated in Figure \@ref(fig:MEAPEAR1-REQ-2019).

```{r, MEAPEAR1-REQ-2019, echo=FALSE,fig.cap='The electricity requirement profile from MEA and PEA R1 in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 EGAT NET electricity generation profile

The EGAT net electricity generation profile is calculated by the summation of the electricity requirement in each region.

\begin{equation}
EGTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4} PEAReq_{i,t,h} + \sum_{c=1}^{2}EXPReq_{c,t,h}
(\#eq:egtNetGenCal)
\end{equation}

Where,
$EGTNETGEN_{i,t,h}$ denotes the EGAT net electricity generation ($EGTNETGEN$) profile in region $i$ in year $t$ at time stamp $h$ (MW).\
$MEAReq_{t,h}$ denotes the MEA requirement profile ($MEAReq$) in year $t$ at time stamp $h$ (MW).\
$PEAReq_{i,t,h}$ denotes the PEA requirement ($PEAReq$) profile in region $i$ in year $t$ at time stamp $h$ (MW).
$EXPReq_{c,t,h}$ denotes the electricity requirement from neighboring countries $c$ in year $t$ at time stamp $h$. 

```{r egt_ngn_2019}
profile <-
  
  profiledata$`mea&r1_requirement_2019` %>%
  mutate(r2_edl = profiledata$`r2&export_EDL_requirement_2019`$r2_edl,
         r3_tnb = profiledata$`r3&export_TNB_requirement_2019`$r3_tnb,
         r4_requirement = profiledata$r4_northern_requirement_2019$NAC,
         egt_netgen = mea_r1 + r2_edl + r3_tnb + r4_requirement) %>% 
  select(-mea_r1, -r2_edl, -r3_tnb, -r4_requirement)

# Summary data ####
maxv <- ceiling(max(profile$egt_netgen)) # Get a peak MW
minv <- floor(min(profile$egt_netgen)) # Get a min MW
energy <- sum(profile$egt_netgen)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(egt_netgen == max(egt_netgen)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(egt_netgen == min(egt_netgen)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-egtngn-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a EGAT net generation profile in 2019',
  booktabs = TRUE
)
```

```{r plot_egtngn2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = egt_netgen,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "EGAT NET Electricity generation (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-3)*1.1,2000),
                     limits = c(0, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.05),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "egt_netgen_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("egt_netgen_2019" = profile))
profilefigure <- c(profilefigure, list("egt_netgen_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_egt_netgen_2019" = summary))
```

The 2019 EGAT net genration profile is illustrated in Figure \@ref(fig:EGT-NGN-2019).

```{r, EGT-NGN-2019, echo=FALSE,fig.cap='The EGAT net generation profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

<!--chapter:end:02.2-requirementProfiles.Rmd-->

# The transmission loss and use profiles
## The 2019 transmission loss and use profile

A transmissions loss profile is calculated from the difference between the EGAT net electricity generation and the EGAT electricity sale profile (see equation \@ref(eq:prfLossCal))

\begin{equation}

LSS_{i,t,h} = EGTNETGEN_{i,t,h} - EGTSLE_{i,t,h}
(\#eq:prfLossCal)

\end{equation}

Where,
$LSS_{i,t,h}$ denotes a transmission loss profile in region $i$ in year $t$ at time stamp $h$ (MW).\
$EGTNETGEN_{i,t,h}$ denotes a EGAT net generation profile in region $i$ in year $t$ at time stamp $h$ (MW) (see equation \@ref(eq:egtNetGenCal)).\
$EGTSLE_{i,t,h}$ denotes the electricity EGAT sale ($EGTSLE$) profile in year $t$ at time stamp $h$ (MW) (see equation \@ref(eq:prfEgtsleCal)). 

```{r transloss_2019}
profile <-
  
  profiledata$`egt_netgen_2019` %>%
  mutate(egt_sle = profiledata$egtsle_2019$egt_sle,
         tran_loss = egt_netgen - egt_sle) %>% 
  select(-egt_netgen, -egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$tran_loss)) # Get a peak MW
minv <- floor(min(profile$tran_loss)) # Get a min MW
energy <- sum(profile$tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(tran_loss == max(tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(tran_loss == min(tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a transmission loss profile in 2019',
  booktabs = TRUE
)
```

```{r plot_trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Transmission loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-3), round(maxv,-3)*1.2,200),
                     limits = c(round(minv,-3)*1.1, round(maxv, -3)*1.1)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)*1.05),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_tran_loss_2019" = summary))

```

The 2019 transmission loss profile is illustrated in Figure \@ref(fig:TRTLOSS-2019).

```{r, TRTLOSS-2019, echo=FALSE,fig.cap='Transmission loss profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

###The 2019 MEA transmission loss and use profile

```{r meatransloss_2019}
profile <-
  
  profiledata$mea_requirement_2019 %>%
  mutate(mea_egt_sle = profiledata$mea_egtsle_2019$MEA,
         mea_tran_loss = MAC - mea_egt_sle) %>% 
  select(-MAC, -mea_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$mea_tran_loss)) # Get a peak MW
minv <- floor(min(profile$mea_tran_loss)) # Get a min MW
energy <- sum(profile$mea_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(mea_tran_loss == max(mea_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(mea_tran_loss == min(mea_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-meatrtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_meatrtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = mea_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA transmission loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-3), round(maxv,-3)*1.2,200),
                     limits = c(round(minv,-3)*1.1, round(maxv, -3))) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -3)),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = 0.8,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("mea_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_tran_loss_2019" = summary))

```

The 2019 MEA transmission loss and use profile is illustrated in Figure \@ref(fig:MEATRTLOSS-2019).

```{r, MEATRTLOSS-2019, echo=FALSE,fig.cap='The MEA transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R1 (Central region) transmission loss and use profile

```{r pear1transloss_2019}
profile <-
  
  profiledata$r1_central_requirement_2019 %>%
  mutate(r1_egt_sle = profiledata$`r1+dcr1_egtsle_2019`$r1_egt_sle,
         r1_tran_loss = CAC - r1_egt_sle) %>% 
  select(-CAC, -r1_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r1_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r1_tran_loss)) # Get a min MW
energy <- sum(profile$r1_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r1_tran_loss == max(r1_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r1_tran_loss == min(r1_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor)
```

```{r, sum-pear1trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R1 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r1_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R1 (Central region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-3), round(maxv,-2)*1.1,200),
                     limits = c(round(minv,-2)*1.1, round(maxv, -2)*2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.4),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            hjust = -0.1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1.9)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r1_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1_tran_loss_2019" = summary))
```

The 2019 PEA R1 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR1TRTLOSS-2019).

```{r, PEAR1TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R1 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R2 (North Eastern region) transmission loss and use profile

```{r pear2transloss_2019}
profile <-
  
  profiledata$`r2&export_EDL_requirement_2019` %>%
  mutate(r2_egt_sle = profiledata$`r2+dcr2_egtsle_2019`$r2_egt_sle,
         r2_tran_loss = r2_edl - r2_egt_sle) %>% 
  select(-r2_edl, -r2_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r2_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r2_tran_loss)) # Get a min MW
energy <- sum(profile$r2_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r2_tran_loss == max(r2_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r2_tran_loss == min(r2_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-pear2trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R2 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r2_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R2 (North Eastern region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-2), round(maxv,-2)*1.3,200),
                     limits = c(round(minv,-2)*1.1, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 8.5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r2_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2_tran_loss_2019" = summary))
```

The 2019 PEA R2 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR2TRTLOSS-2019).

```{r, PEAR2TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R2 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R3 (Southern region) transmission loss and use profile

```{r pear3transloss_2019}
profile <-
  
  profiledata$`r3&export_TNB_requirement_2019`%>%
  mutate(r3_egt_sle = profiledata$`r3+dcr3_egtsle_2019`$r3_egt_sle,
         r3_tran_loss = r3_tnb - r3_egt_sle) %>% 
  select(-r3_tnb, -r3_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r3_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r3_tran_loss)) # Get a min MW
energy <- sum(profile$r3_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r3_tran_loss == max(r3_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r3_tran_loss == min(r3_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear3trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R3 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r3_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R3 (Southern region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-2), round(maxv,-2)*2,200),
                     limits = c(round(minv,-2)*2, round(maxv, -2)*1.4)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 0.5) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 5)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r3_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3_tran_loss_2019" = summary))
```

The 2019 PEA R3 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR3TRTLOSS-2019).

```{r, PEAR3TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R3 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

### The 2019 PEA-R4 (Northern region) transmission loss and use profile 

```{r pear4transloss_2019}
profile <-
  
  profiledata$r4_northern_requirement_2019%>%
  mutate(r4_egt_sle = profiledata$`r4+dcr4_egtsle_2019`$r4_egt_sle,
         r4_tran_loss = NAC - r4_egt_sle) %>% 
  select(-NAC, -r4_egt_sle)

# Summary data ####
maxv <- ceiling(max(profile$r4_tran_loss)) # Get a peak MW
minv <- floor(min(profile$r4_tran_loss)) # Get a min MW
energy <- sum(profile$r4_tran_loss)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(r4_tran_loss == max(r4_tran_loss)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(r4_tran_loss == min(r4_tran_loss)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear4trtloss-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a PEA R4 transmission loss and use profile in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4trtloss2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = r4_tran_loss,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "PEA R4 (Northern region) transmission\n loss & use (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(round(minv,-2), round(maxv,-2)*2,200),
                     limits = c(round(minv,-2)*1.2, round(maxv, -2)*1.3)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 3) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            # hjust = 0,
            vjust = 9)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4_tran_loss_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4_tran_loss_2019" = profile))
profilefigure <- c(profilefigure, list("r4_tran_loss_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4_tran_loss_2019" = summary))
```

The 2019 PEA R4 transmission loss and use profile is illustrated in Figure \@ref(fig:PEAR4TRTLOSS-2019).

```{r, PEAR4TRTLOSS-2019, echo=FALSE,fig.cap='The PEA R4 transmission loss and use profile in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```


<!--chapter:end:03.1-transLoss.Rmd-->

# Total net generation requirement profile

Total net electricity net generation requirement is calculated by the summation of an electricity requirement and VSPP in each region as given in equation \@ref(eq:totalNetGenCal). 


\begin{equation}

TOTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4}(PEAReq_{i,t,h} + VSPP_{i,t,h})
(\#eq:totalNetGenCal)

\end{equation}

Where,
$TOT_NET_GEN_{i,t,h}$ denotes total net electricity generation requirement in region $i$ in year $t$ at time stamp $h$ (MW).\
$MEAReq_{t,h}$ denotes the MEA requirement profile in year $t$ at time stamp $h$ (MW).\
$PEAReq_{i,t,h}$ denotes the PEA requirement profile in region $i$ in year $t$ at time stamp $h$ (MW).\
$VSPP_{i,t,h}$ denotes the electricity generation from $VSPP$ in region $i$ in year $t$ at time stamp $h$ (MW).\

## The 2019 MEA Total net generation requirement profile

```{r meatotnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, MAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, MAC)

# Summary data ####
maxv <- ceiling(max(profile$MAC)) # Get a peak MW
minv <- floor(min(profile$MAC)) # Get a min MW
energy <- sum(profile$MAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(MAC == max(MAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(MAC == min(MAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-meatotnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of a MEA total net electricity generation profile in 2019',
  booktabs = TRUE
)
```

```{r plot_meatotnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = MAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "MEA Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,1000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 3) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "mea_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("mea_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("mea_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_mea_total_netgen_req_2019" = summary))

```

The 2019 MEA total net electricity generation is illustrated in Figure \@ref(fig:MEA-TOTNETGEN-2019).

```{r, MEA-TOTNETGEN-2019, echo=FALSE,fig.cap='The MEA total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R1 (Central region) total net generation requirement profile

```{r pear1totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, CAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, CAC)

# Summary data ####
maxv <- ceiling(max(profile$CAC)) # Get a peak MW
minv <- floor(min(profile$CAC)) # Get a min MW
energy <- sum(profile$CAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(CAC == max(CAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(CAC == min(CAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear1totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R1 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear1totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = CAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R1 (Central region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,1000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = 0)

# Save the output ####
outputfigure <- paste0(outfigdir, "r1_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r1_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r1_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r1_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R1 is illustrated in Figure \@ref(fig:PEAR1-TOTNETGEN-2019).

```{r, PEAR1-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R1 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R2 (North Eastern region) total net generation requirement profile

```{r pear2totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, NEC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NEC)

# Summary data ####
maxv <- ceiling(max(profile$NEC)) # Get a peak MW
minv <- floor(min(profile$NEC)) # Get a min MW
energy <- sum(profile$NEC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NEC == max(NEC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NEC == min(NEC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-pear2totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R2 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear2totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NEC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R2 (North Eastern region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,1000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = -1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r2_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r2_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r2_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r2_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R2 is illustrated in Figure \@ref(fig:PEAR2-TOTNETGEN-2019).

```{r, PEAR2-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R2 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R3 (Southern region) total net generation requirement profile

```{r pear3totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, SAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, SAC)

# Summary data ####
maxv <- ceiling(max(profile$SAC)) # Get a peak MW
minv <- floor(min(profile$SAC)) # Get a min MW
energy <- sum(profile$SAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(SAC == max(SAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(SAC == min(SAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-pear3totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R3 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear3totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = SAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R3 (Southern region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,500),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = -0.05,
            vjust = -1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r3_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r3_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r3_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r3_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R3 is illustrated in Figure \@ref(fig:PEAR3-TOTNETGEN-2019).

```{r, PEAR3-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R3 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 PEA R4 (Northern region) total net generation requirement profile

```{r pear4totnetgen_2019}
profile <-
  
  read_excel("raw_data/raw_data_profiles/02_Hourly Sale_NetGen_2019.xlsx",
             sheet = "Load Curve",
             range = "BK3:BQ17523") %>% 
  select(datetime = `Date/Time`, NAC) %>% 
  mutate(date = date(datetime),
         time = format(as.POSIXct(datetime),"%H:%M:%S"),
         year = year(datetime),
         month = month(datetime),
         day = day(datetime)) %>% 
  select(datetime, date, time, year, month, day, NAC)

# Summary data ####
maxv <- ceiling(max(profile$NAC)) # Get a peak MW
minv <- floor(min(profile$NAC)) # Get a min MW
energy <- sum(profile$NAC)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(NAC == max(NAC)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(NAC == min(NAC)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table
```

```{r, sum-pear4totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in PEA R4 in 2019',
  booktabs = TRUE
)
```

```{r plot_pear4totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = NAC,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "R4 (Northern region) Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,500),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 1,
            vjust = -1)

# Save the output ####
outputfigure <- paste0(outfigdir, "r4_total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("r4_total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("r4_total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_r4_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation in PEA R4 is illustrated in Figure \@ref(fig:PEAR4-TOTNETGEN-2019).

```{r, PEAR4-TOTNETGEN-2019, echo=FALSE,fig.cap='The PEA R4 total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

## The 2019 Total net generation requirement profile

Total net electricity generation is calculated by the summation of total net electricity generation in MEA and PEA regions as given in equation \@ref(eq:totalNetGenCal).

```{r totnetgen_2019}
profile <-
  
  profiledata$mea_total_netgen_req_2019 %>% 
  mutate(cac_tot_netgen = profiledata$r1_total_netgen_req_2019$CAC,
         nec_tot_netgen = profiledata$r2_total_netgen_req_2019$NEC,
         sac_tot_netgen = profiledata$r3_total_netgen_req_2019$SAC,
         nac_tot_netgen = profiledata$r4_total_netgen_req_2019$NAC,
         tot_netgen_req = MAC + cac_tot_netgen + nec_tot_netgen + sac_tot_netgen + nac_tot_netgen) %>% 
  select(-MAC, -cac_tot_netgen, -nec_tot_netgen, -sac_tot_netgen, -nac_tot_netgen)

# Summary data ####
maxv <- ceiling(max(profile$tot_netgen_req)) # Get a peak MW
minv <- floor(min(profile$tot_netgen_req)) # Get a min MW
energy <- sum(profile$tot_netgen_req)/2000 # Calculate the energy
peak_day <- profile %>% #Find a peak day
  group_by(year) %>% 
  filter(tot_netgen_req == max(tot_netgen_req)) %>% 
  pull(datetime)
min_day <- profile %>% #Find a min day
  group_by(year) %>% 
  filter(tot_netgen_req == min(tot_netgen_req)) %>% 
  last() %>%  
  pull(datetime)
load_factor <- percent((energy*10^3)/(maxv*8760), 
                       accuracy = 0.01, 
                       decimal.mark = ".")
summary <- tibble(peak_day = peak_day,
                  min_day = min_day,
                  peak_mw = maxv, 
                  min_mw = minv, 
                  energy_gwh = energy,
                  load_factor = load_factor) # combine all data in 1 table

```

```{r, sum-totnetgen-2019, echo=FALSE, tidy=FALSE}
knitr::kable(
  summary, caption = 'Summary of total net electricity generation profile in 2019',
  booktabs = TRUE
)
```

```{r plot_totnetgen2019}
profile_plot <-
  ggplot() + 
  geom_line(data=profile, 
            aes(x = datetime, 
                y = tot_netgen_req,
                group = month,
                color = as.factor(month)),
            show.legend = FALSE) +
  ThemeLine +
  labs(x = NULL,
       y = "Total net generation requiremnet (MW)")+
  scale_x_datetime(breaks=date_breaks("1 month"), 
                   labels=date_format("%b %y")) +
  scale_y_continuous(breaks = seq(0, round(maxv,-2)*1.2,2000),
                     limits = c(0, round(maxv, -2)*1.2)) +  
  scale_color_manual(values = linepalette1) +
  geom_point(data=summary,
             aes(x = peak_day, y = peak_mw))+
  # geom_hline(yintercept = 0) +
  geom_text(data = summary,
            aes(x = peak_day, y = round(maxv, -2)*1.2),
            label = glue("Peak {maxv} MW \n@ {peak_day}"),
            # hjust = 1,
            vjust = 1) +
  geom_point(data=summary,
             aes(x = min_day, y = min_mw))+
  geom_text(data = summary,
            aes(x = min_day, y = round(minv, -3)*0.8),
            label = glue("Minimum {minv} MW \n@ {min_day}"),
            hjust = 0,
            vjust = 1)

# Save the output ####
outputfigure <- paste0(outfigdir, "total_netgen_req_2019.png")
ggsave(profile_plot, file = outputfigure, dpi = 150, width = 15, height = 5, units = "in", limitsize = FALSE)
profiledata <- c(profiledata, list("total_netgen_req_2019" = profile))
profilefigure <- c(profilefigure, list("total_netgen_req_2019" = profile_plot))
summarydata <- c(summarydata, list("sum_total_netgen_req_2019" = summary))
```

The 2019 total net electricity generation is illustrated in Figure \@ref(fig:TOTNETGEN-2019).

```{r, TOTNETGEN-2019, echo=FALSE,fig.cap='Total net electricity generation requirement in 2019.', fig.align='center', out.width= '100%'}
ggplotly(profile_plot) %>% layout(showlegend = FALSE)
```

<!--chapter:end:04.1-totalNetGen.Rmd-->

# Vary small power producer (VSPP) situation

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
```

```{r, mea_vspp_ene_ext, echo = TRUE, warning=FALSE, message=FALSE}
mea_vspp_ene_ext <-

read_excel("raw_data/01 EGAT_20Oct2022_งบ66 67_Final.xlsx",
           sheet = "I_Actual",
           range = "CE7:CM31",
           col_names = c("solar", "wind", "biomass", "biogas", "msw", "hydro", "enecrop", "cogen", "tot_vspp_gwh")) %>% 
  replace(is.na(.),0) %>% 
  mutate(year = 1997:2021,
         year_th = year + 543) %>% 
  select(year, year_th,everything()) %>%
  pivot_longer(-year&-year_th, names_to = "fuel", values_to = "mea_vspp_gwh")
```

```{r, vsppene-2019, echo=FALSE, fig.cap='Electricity generation from VSPP in 2019.', fig.align='center', out.width= '90%'}
mea_vspp_ene_ext %>% 
  filter(year >=2005) %>% 
  ggplot(aes(x = year, y = mea_vspp_gwh, group = fuel, color = fuel)) +
  geom_line(show.legend = FALSE) +
  facet_wrap(~fuel, scales = "free_y")+
  ThemeLine +
  labs(x = NULL,
       y = "Electricity generation from VSPP (GWh)")
```


<!--chapter:end:05-vsppextcal.Rmd-->

# List of equations {-}

Calculated energy (electricity) from sale profiles \@ref(eq:energycal)

\begin{equation}
 
 Ene_{t}=\frac{\sum_{h=1}^{17520} (Prf_{t,h})}{2*1000}
 (\#eq:energycal)

\end{equation}

Load factor \@ref(eq:loadfactorcal)

\begin{equation}

 LF_{t}=\frac{Energy_{t}}{Peak_{d,h} * 8760}*100 
 (\#eq:loadfactorcal)

\end{equation} 

Electricity profile in PEA region \@ref(eq:prfPeaDcCal)

\begin{equation}
 
 Prf_{r,t,h}=\ Prf_{PEA,t,h} + Prf_{DC,t,h}
 (\#eq:prfPeaDcCal)

\end{equation}

Electricity EGAT sale profile \@ref(eq:prfEgtsleCal)

\begin{equation}

 EGTSLE_{t,h}=\ MEA_{t,h} + \sum_{i=1}^{4} (PEA_{i,t,h} + DC_{i,t,h}) 
 (\#eq:prfEgtsleCal)

\end{equation}

EGAT net electricity generation profile \@ref(eq:egtNetGenCal)

\begin{equation}

EGTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4} PEAReq_{i,t,h} + \sum_{c=1}^{2}EXPReq_{c,t,h}
(\#eq:egtNetGenCal)

\end{equation}

Transmissions loss profile \@ref(eq:prfLossCal)

\begin{equation}

LSS_{i,t,h} = EGTNETGEN_{i,t,h} - EGTSLE_{i,t,h}
(\#eq:prfLossCal)

\end{equation}

Total net generation requirement profile \@ref(eq:totalNetGenCal)

\begin{equation}

TOTNETGEN_{i,t,h} = MEAReq_{t,h} + \sum_{i=1}^{4}(PEAReq_{i,t,h} + VSPP_{i,t,h})
(\#eq:totalNetGenCal)

\end{equation}

<!--chapter:end:06-listofeqns.Rmd-->

# List of figures {-}

| Figure name | Figure number |
| :-----------|:-------------:|
| Fuel consumption for electricity generation from 2017–2021 | \@ref(fig:fig-fuelelygen2017-2021) |
| EGAT electricity sale profile to MEA in 2019 | \@ref(fig:EGAT-sale-to-MEA-2019) |
| EGAT electricity sale profile to PEA-R1 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R1-2019) |
| EGAT electricity sale profile to PEA-R2 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R2-2019) |
| EGAT electricity sale profile to PEA-R3 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R3-2019) |
| EGAT electricity sale profile to PEA-R4 in 2019 | \@ref(fig:EGAT-sale-to-PEA-R4-2019) |
| EGAT electricity sale profile to PEA (all regions) in 2019 | \@ref(fig:EGAT-sale-to-PEA-allregion-2019) |
| EGAT electricity sale profile to direct customer in PEA-R1 in 2019 | \@ref(fig:EGAT-sale-to-DCR1-2019) |
| EGAT electricity sale profile to direct customer in PEA-R2 in 2019 | \@ref(fig:EGAT-sale-to-DCR2-2019) |
| EGAT electricity sale profile to direct customer in PEA-R3 in 2019 | \@ref(fig:EGAT-sale-to-DCR3-2019) |
| EGAT electricity sale profile to direct customer in PEA-R4 in 2019 | \@ref(fig:EGAT-sale-to-DCR4-2019) |
| EGAT electricity sale profile to direct customer in PEA (all regions) in 2019 | \@ref(fig:EGAT-sale-to-DCALLREG-2019)|
| EGAT electricity sale profile to PEA R1 and direct customer in PEA R1 in 2019 | \@ref(fig:EGAT-sale-to-pear1-dcr1-2019) |
| EGAT electricity sale profile to PEA R2 and direct customer in PEA R2 in 2019 | \@ref(fig:EGAT-sale-to-pear2-dcr2-2019) |
| EGAT electricity sale profile to PEA R3 and direct customer in PEA R3 in 2019 | \@ref(fig:EGAT-sale-to-pear3-dcr3-2019) |
| EGAT electricity sale profile to PEA R4 and direct customer in PEA R4 in 2019 | \@ref(fig:EGAT-sale-to-pear4-dcr4-2019) |
| EGAT electricity sale profile 2019 | \@ref(fig:EGAT-sale-2019) |
| MEA electricity requirement profile in 2019 | \@ref(fig:MEA-REQ-2019) |
| The electricity requirement profile from PEA R1 in 2019 | \@ref(fig:PEAR1-REQ-2019) |
| The electricity requirement profile from PEA R2 in 2019 | \@ref(fig:PEAR2-REQ-2019) |
| The electricity requirement profile from PEA R3 in 2019 | \@ref(fig:PEAR3-REQ-2019) |
| The electricity requirement profile from PEA R4 in 2019 | \@ref(fig:PEAR4-REQ-2019) |
| The electricity requirement profile from TNB in 2019 | \@ref(fig:TNB-REQ-2019) |
| The electricity requirement profile from EDL in 2019 | \@ref(fig:EDL-REQ-2019) |
| The electricity requirement profile from PEA R2 and EDL in 2019 | \@ref(fig:R2EDL-REQ-2019) |
| The electricity requirement profile from PEA R3 and TNB in 2019 | \@ref(fig:R3TNB-REQ-2019) |
| The electricity requirement profile from MEA and PEA R1 in 2019 | \@ref(fig:MEAPEAR1-REQ-2019) |
| The EGAT net generation profile in 2019 | \@ref(fig:EGT-NGN-2019) |
| Transmission loss profile in 2019 | \@ref(fig:TRTLOSS-2019) |
| The MEA transmission loss and use profile in 2019 | \@ref(fig:MEATRTLOSS-2019) |
| The PEA R1 transmission loss and use profile in 2019 | \@ref(fig:PEAR1TRTLOSS-2019) |
| The PEA R2 transmission loss and use profile in 2019 | \@ref(fig:PEAR2TRTLOSS-2019) |
| The PEA R3 transmission loss and use profile in 2019 | \@ref(fig:PEAR3TRTLOSS-2019) |
| The PEA R4 transmission loss and use profile in 2019 | \@ref(fig:PEAR4TRTLOSS-2019) |
| The MEA total net electricity generation requirement in 2019 | \@ref(fig:MEA-TOTNETGEN-2019) |
| The PEA R1 total net electricity generation requirement in 2019 | \@ref(fig:PEAR1-TOTNETGEN-2019) |
| The PEA R2 total net electricity generation requirement in 2019 | \@ref(fig:PEAR2-TOTNETGEN-2019) |
| The PEA R3 total net electricity generation requirement in 2019 | \@ref(fig:PEAR3-TOTNETGEN-2019) |
| The PEA R4 total net electricity generation requirement in 2019 | \@ref(fig:PEAR4-TOTNETGEN-2019) |
| Total net electricity generation requirement in 2019 | \@ref(fig:TOTNETGEN-2019) |

<!--chapter:end:07-listofFigures.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:08-references.Rmd-->


<!--chapter:end:electricity-profiles.Rmd-->

